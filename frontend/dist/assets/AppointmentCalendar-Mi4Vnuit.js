import{r as n,g as ce,j as t,B as S,R as me}from"./index-CFS5meP2.js";import{F as ge}from"./CalendarDaysIcon-Cp9xBLy9.js";import{F as ue}from"./InformationCircleIcon-DF1m2Q78.js";function pe({title:u,titleId:p,...f},x){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":p},f),u?n.createElement("title",{id:p},u):null,n.createElement("path",{fillRule:"evenodd",d:"M7.72 12.53a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.31 12l6.97 6.97a.75.75 0 1 1-1.06 1.06l-7.5-7.5Z",clipRule:"evenodd"}))}const fe=n.forwardRef(pe);function xe({title:u,titleId:p,...f},x){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":p},f),u?n.createElement("title",{id:p},u):null,n.createElement("path",{fillRule:"evenodd",d:"M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z",clipRule:"evenodd"}))}const he=n.forwardRef(xe),N=9,V=21,T=30;function je({onSlotClick:u,onAppointmentClick:p,tatuatori:f,stanze:x}){const[m,_]=n.useState(()=>{const e=new Date;return e.setHours(0,0,0,0),e}),[h,C]=n.useState("week"),[v,G]=n.useState("tatuatore"),[k,U]=n.useState([]),[R,E]=n.useState(!0),[w,I]=n.useState(""),[b,q]=n.useState(""),[y,P]=n.useState("");n.useEffect(()=>{Y()},[m,b,y,h]);const W=e=>{const r=new Date(e);return r.setHours(0,0,0,0),r},O=e=>{const r=new Date(e);return r.setHours(23,59,59,999),r},z=e=>{const r=new Date(e),a=r.getDay(),o=r.getDate()-a+(a===0?-6:1);return r.setDate(o),W(r)},M=e=>{const r=z(e),a=new Date(r);return a.setDate(r.getDate()+6),O(a)},A=(e,r)=>r==="day"?{start:W(e),end:O(e)}:{start:z(e),end:M(e)},Y=async()=>{try{E(!0),I("");const e=ce("adminToken"),{start:r,end:a}=A(m,h),o=new URLSearchParams({data_inizio:r.toISOString(),data_fine:a.toISOString()});b&&o.append("tatuatore_id",b),y&&o.append("stanza_id",y);const c=await fetch(`/api/admin/appuntamenti?${o}`,{headers:{Authorization:`Bearer ${e}`}});if(!c.ok)throw new Error("Errore nel recupero appuntamenti");const i=await c.json();U(i.appuntamenti||[])}catch(e){console.error("Errore nel caricamento appuntamenti:",e),I("Errore nel caricamento degli appuntamenti")}finally{E(!1)}},L=e=>{const r=new Date(m);h==="week"?r.setDate(r.getDate()+e*7):r.setDate(r.getDate()+e),r.setHours(0,0,0,0),_(r)},Z=()=>{const e=new Date;e.setHours(0,0,0,0),_(e)},J=()=>{if(h==="week"){const e=z(m),r=[];for(let a=0;a<7;a++){const o=new Date(e);o.setDate(e.getDate()+a),r.push(o)}return r}else return[m]},K=()=>{const e=[];for(let r=N;r<V;r++)for(let a=0;a<60;a+=T){const o=new Date;o.setHours(r,a,0,0),e.push({hour:r,minute:a,time:o.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})}return e},Q=(e,r,a)=>{const o=new Date(e);o.setHours(r,a,0,0);const c=new Date(o.getTime()+T*6e4);return k.filter(i=>{const l=new Date(i.orario_inizio),d=new Date(l.getTime()+i.durata_minuti*6e4);return l<c&&d>o&&l.getDate()===e.getDate()&&l.getMonth()===e.getMonth()&&l.getFullYear()===e.getFullYear()})},B=e=>{switch(e){case"confermato":return"rgba(34, 197, 94, 0.8)";case"completato":return"rgba(34, 197, 94, 0.6)";case"cancellato":return"rgba(239, 68, 68, 0.8)";case"in_corso":return"rgba(245, 158, 11, 0.8)";default:return"rgba(107, 114, 128, 0.8)"}},X=()=>{if(h==="week"){const e=z(m),r=M(m);return`${e.toLocaleDateString("it-IT")} - ${r.toLocaleDateString("it-IT")}`}else return m.toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},ee=e=>{switch(v){case"stanza":return{key:e.stanza_id||"no_room",label:e.stanza_nome||"Stanza non assegnata",accent:"rgba(24, 24, 27, 0.85)"};case"stato":return{key:e.stato||"sconosciuto",label:(e.stato||"Sconosciuto").replace("_"," "),accent:B(e.stato)};case"tatuatore":default:return{key:e.tatuatore_id||"no_artist",label:e.tatuatore_nome||"Tatuatore non assegnato",accent:"rgba(249, 115, 22, 0.6)"}}},te=e=>{if(!e.length)return[];const r=new Map;e.forEach(i=>{const l=ee(i);r.has(l.key)||r.set(l.key,{meta:l,appointments:[]}),r.get(l.key).appointments.push(i)});const a={confermato:1,in_corso:2,completato:3,cancellato:4},o=v==="tatuatore"?ie.map(i=>i.id):v==="stanza"?se.map(i=>i.id):[],c=Array.from(r.values());return c.forEach(i=>{i.appointments.sort((l,d)=>new Date(l.orario_inizio)-new Date(d.orario_inizio))}),c.sort((i,l)=>{if(v==="stato")return(a[i.meta.key]||99)-(a[l.meta.key]||99);if(o.length){const d=o.indexOf(i.meta.key),s=o.indexOf(l.meta.key);if(d!==-1||s!==-1)return(d===-1?99:d)-(s===-1?99:s)}return i.meta.label.localeCompare(l.meta.label,"it")})},re=e=>{const r=new Date(e.orario_inizio),a=new Date(r.getTime()+e.durata_minuti*6e4);return`${r.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})} - ${a.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}`},{start:F,end:$}=n.useMemo(()=>A(m,h),[m,h]),g=n.useMemo(()=>k.filter(e=>{const r=new Date(e.orario_inizio);return r>=F&&r<=$}),[k,F,$]),D=n.useMemo(()=>{const e={confermato:0,in_corso:0,completato:0,cancellato:0};return g.forEach(r=>{e[r.stato]=(e[r.stato]||0)+1}),e},[g]),ae=n.useMemo(()=>new Set(g.map(e=>e.tatuatore_id)).size,[g]),ne=n.useMemo(()=>new Set(g.map(e=>e.stanza_id)).size,[g]),oe=n.useMemo(()=>(g.reduce((r,a)=>r+(a.durata_minuti||0),0)/60).toFixed(1),[g]),ie=n.useMemo(()=>Array.isArray(f)?b?f.filter(e=>e.id===b):f:[],[f,b]),se=n.useMemo(()=>Array.isArray(x)?y?x.filter(e=>e.id===y):x:[],[x,y]),j=J(),le=K(),H=g.length>0;return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[t.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:"6px",padding:"1rem"},children:[t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.8rem",textTransform:"uppercase",letterSpacing:"0.08em"},children:"Totale appuntamenti"}),t.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"700",color:"#fbbf24"},children:g.length}),t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.8rem"},children:"Nel periodo selezionato"})]}),t.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:"6px",padding:"1rem"},children:[t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.8rem",textTransform:"uppercase",letterSpacing:"0.08em"},children:"Tatuatori coinvolti"}),t.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"700",color:"#fbbf24"},children:ae}),t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.8rem"},children:"Risorse umane in agenda"})]}),t.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:"6px",padding:"1rem"},children:[t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.8rem",textTransform:"uppercase",letterSpacing:"0.08em"},children:"Stanze occupate"}),t.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"700",color:"#fbbf24"},children:ne}),t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.8rem"},children:"Spazi prenotati"})]}),t.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:"6px",padding:"1rem"},children:[t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.8rem",textTransform:"uppercase",letterSpacing:"0.08em"},children:"Ore pianificate"}),t.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"700",color:"#34d399"},children:oe}),t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.8rem"},children:"Totale durata appuntamenti"})]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem",flexWrap:"wrap",gap:"1rem"},children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"section-title",children:[t.jsx(ge,{className:"section-title-icon","aria-hidden":"true"})," Calendario Appuntamenti"]}),t.jsx("p",{style:{color:"#9ca3af",fontSize:"0.9rem",margin:0},children:X()}),t.jsxs("p",{style:{color:"#6b7280",fontSize:"0.75rem",margin:"0.2rem 0 0"},children:["Orario servizio: ",N.toString().padStart(2,"0"),":00 - ",(V-1).toString().padStart(2,"0"),":59 • Slot di ",T," minuti"]})]}),t.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.jsx(S,{variant:"secondary",onClick:()=>L(-1),style:{padding:"0.5rem 1rem",fontSize:"0.9rem"},"aria-label":"Giorno precedente",children:t.jsx(fe,{className:"icon-inline icon-no-margin","aria-hidden":"true"})}),t.jsx(S,{onClick:Z,variant:"secondary",children:"Oggi"}),t.jsx(S,{variant:"secondary",onClick:()=>L(1),style:{padding:"0.5rem 1rem",fontSize:"0.9rem"},"aria-label":"Giorno successivo",children:t.jsx(he,{className:"icon-inline icon-no-margin","aria-hidden":"true"})})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.jsx(S,{variant:h==="day"?"primary":"secondary",onClick:()=>C("day"),style:{fontSize:"0.9rem"},children:"Giorno"}),t.jsx(S,{variant:h==="week"?"primary":"secondary",onClick:()=>C("week"),style:{fontSize:"0.9rem"},children:"Settimana"})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[t.jsx("label",{style:{color:"#9ca3af",fontSize:"0.8rem"},children:"Raggruppa per"}),t.jsxs("select",{value:v,onChange:e=>G(e.target.value),style:{padding:"0.5rem",backgroundColor:"#000000",border:"1px solid rgba(255, 255, 255, 0.12)",borderRadius:"6px",color:"#f3f4f6",fontSize:"0.9rem"},children:[t.jsx("option",{value:"tatuatore",children:"Tatuatore"}),t.jsx("option",{value:"stanza",children:"Stanza"}),t.jsx("option",{value:"stato",children:"Stato"})]})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsxs("select",{value:b,onChange:e=>q(e.target.value),style:{padding:"0.5rem",backgroundColor:"#000000",border:"1px solid rgba(255, 255, 255, 0.12)",borderRadius:"6px",color:"#f3f4f6",fontSize:"0.9rem"},children:[t.jsx("option",{value:"",children:"Tutti i tatuatori"}),f.map(e=>t.jsx("option",{value:e.id,children:e.nome},e.id))]}),t.jsxs("select",{value:y,onChange:e=>P(e.target.value),style:{padding:"0.5rem",backgroundColor:"#000000",border:"1px solid rgba(255, 255, 255, 0.12)",borderRadius:"6px",color:"#f3f4f6",fontSize:"0.9rem"},children:[t.jsx("option",{value:"",children:"Tutte le stanze"}),x.map(e=>t.jsx("option",{value:e.id,children:e.nome},e.id))]})]})]})]}),t.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap",marginBottom:"1.5rem"},children:[{label:"Confermati",value:D.confermato,color:"rgba(34, 197, 94, 0.25)"},{label:"In corso",value:D.in_corso,color:"rgba(245, 158, 11, 0.25)"},{label:"Completati",value:D.completato,color:"rgba(34, 197, 94, 0.15)"},{label:"Cancellati",value:D.cancellato,color:"rgba(239, 68, 68, 0.2)"}].map(e=>t.jsxs("div",{style:{flex:"1 1 160px",minWidth:"150px",padding:"0.75rem",borderRadius:"6px",background:e.color,border:"1px solid rgba(255, 255, 255, 0.1)",color:"#f3f4f6",display:"flex",flexDirection:"column",gap:"0.35rem"},children:[t.jsx("div",{style:{fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.08em",color:"#e5e7eb"},children:e.label}),t.jsx("div",{style:{fontSize:"1.25rem",fontWeight:600},children:e.value})]},e.label))}),R&&t.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#9ca3af"},children:[t.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"0.5rem",fontWeight:600},children:"Caricamento calendario"}),"Attendi qualche istante mentre recuperiamo gli appuntamenti."]}),w&&t.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#ef4444",background:"rgba(239, 68, 68, 0.1)",borderRadius:"4px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[t.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"0.5rem",fontWeight:600},children:"Si è verificato un errore"}),w]}),!R&&!w&&!H&&t.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#9ca3af",background:"rgba(255, 255, 255, 0.05)",borderRadius:"6px",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[t.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"0.5rem",fontWeight:600},children:"Nessun appuntamento disponibile"}),"Nessun appuntamento nel periodo selezionato. Utilizza i pulsanti sopra per aggiungere una nuova prenotazione."]}),!R&&!w&&H&&t.jsx("div",{style:{background:"rgba(255, 255, 255, 0.05)",borderRadius:"4px",border:"1px solid rgba(255, 255, 255, 0.1)",overflow:"hidden"},children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:`120px repeat(${j.length}, 1fr)`,minHeight:"600px"},children:[t.jsx("div",{})," ",j.map((e,r)=>t.jsxs("div",{style:{padding:"1rem",textAlign:"center",background:"rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",borderRight:r<j.length-1?"1px solid rgba(255, 255, 255, 0.05)":"none"},children:[t.jsx("div",{style:{fontWeight:"600",color:"#fbbf24"},children:e.toLocaleDateString("it-IT",{weekday:"short"})}),t.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#f3f4f6"},children:e.getDate()}),t.jsx("div",{style:{fontSize:"0.8rem",color:"#9ca3af"},children:e.toLocaleDateString("it-IT",{month:"short"})})]},r)),le.map((e,r)=>t.jsxs(me.Fragment,{children:[t.jsx("div",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"1px solid rgba(255, 255, 255, 0.05)",borderRight:"1px solid rgba(255, 255, 255, 0.1)",background:"rgba(255, 255, 255, 0.02)",fontSize:"0.8rem",color:"#9ca3af",display:"flex",alignItems:"center",justifyContent:"center"},children:e.time}),j.map((a,o)=>{const c=Q(a,e.hour,e.minute),i=a.toDateString()===new Date().toDateString(),l=te(c);return t.jsxs("div",{onClick:()=>u==null?void 0:u(a,e.hour,e.minute),style:{padding:"0.5rem",borderBottom:"1px solid rgba(255, 255, 255, 0.05)",borderRight:o<j.length-1?"1px solid rgba(255, 255, 255, 0.05)":"none",background:i?"rgba(251, 191, 36, 0.05)":"transparent",cursor:"pointer",position:"relative",minHeight:"60px"},onMouseEnter:d=>{c.length||(d.target.style.background="rgba(255, 255, 255, 0.05)")},onMouseLeave:d=>{c.length||(d.target.style.background=i?"rgba(251, 191, 36, 0.05)":"transparent")},children:[l.map(d=>t.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.65)",border:"1px solid rgba(255, 255, 255, 0.1)",borderLeft:`4px solid ${d.meta.accent}`,borderRadius:"4px",padding:"0.4rem 0.5rem",marginBottom:"0.4rem",color:"#f9fafb",fontSize:"0.8rem",display:"flex",flexDirection:"column",gap:"0.35rem"},onClick:s=>s.stopPropagation(),children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:600,fontSize:"0.85rem",color:"#fbbf24"},children:[t.jsx("span",{children:d.meta.label}),t.jsxs("span",{style:{fontSize:"0.7rem",color:"#d1d5db"},children:[d.appointments.length," appuntamento",d.appointments.length>1?"i":""]})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.3rem"},children:d.appointments.map(s=>t.jsxs("div",{onClick:de=>{de.stopPropagation(),p==null||p(s)},style:{background:B(s.stato),borderRadius:"4px",padding:"0.35rem 0.45rem",cursor:"pointer",display:"flex",flexDirection:"column",gap:"0.2rem",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.25)"},title:`${s.tatuatore_nome} - ${s.cliente_nome||"Senza nome"} (${s.durata_minuti}min)`,children:[t.jsx("div",{style:{fontWeight:600,fontSize:"0.85rem"},children:s.cliente_nome||s.cliente_telefono||"Cliente da definire"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"},children:[t.jsx("span",{children:s.tatuatore_nome}),t.jsx("span",{children:re(s)})]}),t.jsxs("div",{style:{fontSize:"0.7rem",color:"#f3f4f6",opacity:.85},children:[s.stanza_nome,s.durata_minuti?` • ${s.durata_minuti} min`:""]})]},s.id))})]},d.meta.key)),!c.length&&t.jsx("div",{style:{position:"absolute",bottom:"0.25rem",left:"0.25rem",right:"0.25rem",height:"2px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"1px"}})]},o)})]},r))]})}),t.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",background:"rgba(255, 255, 255, 0.05)",borderRadius:"4px",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[t.jsxs("h4",{style:{color:"#fbbf24",marginBottom:"1rem",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(ue,{"aria-hidden":"true",className:"icon-inline icon-no-margin"}),"Legenda"]}),t.jsxs("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("div",{style:{width:"16px",height:"16px",background:"rgba(34, 197, 94, 0.8)",borderRadius:"2px"}}),t.jsx("span",{style:{color:"#f3f4f6",fontSize:"0.9rem"},children:"Confermato"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("div",{style:{width:"16px",height:"16px",background:"rgba(245, 158, 11, 0.8)",borderRadius:"2px"}}),t.jsx("span",{style:{color:"#f3f4f6",fontSize:"0.9rem"},children:"In Corso"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("div",{style:{width:"16px",height:"16px",background:"rgba(34, 197, 94, 0.6)",borderRadius:"2px"}}),t.jsx("span",{style:{color:"#f3f4f6",fontSize:"0.9rem"},children:"Completato"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("div",{style:{width:"16px",height:"16px",background:"rgba(239, 68, 68, 0.8)",borderRadius:"2px"}}),t.jsx("span",{style:{color:"#f3f4f6",fontSize:"0.9rem"},children:"Cancellato"})]})]})]})]})}export{je as default};
