import{r as n,g as E,j as t,B as d,a as it,f as rt,I as _,d as st,M as I,A as ae}from"./index-CFS5meP2.js";import Ae from"./AppointmentForm-CL8yL3D7.js";import lt from"./AppointmentCalendar-Mi4Vnuit.js";import{F as ct,A as dt}from"./AvailabilityChecker-BwrOIwB9.js";import{F as ne}from"./CalendarDaysIcon-Cp9xBLy9.js";import{F as mt,a as ut}from"./TrashIcon-Cv36xBOL.js";import{F as pt}from"./EyeIcon-DnyV7Suk.js";import"./InformationCircleIcon-DF1m2Q78.js";function ht({title:m,titleId:x,...f},y){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:y,"aria-labelledby":x},f),m?n.createElement("title",{id:x},m):null,n.createElement("path",{d:"M18.75 12.75h1.5a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM12 6a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 6ZM12 18a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 18ZM3.75 6.75h1.5a.75.75 0 1 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM5.25 18.75h-1.5a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 0 1.5ZM3 12a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 3 12ZM9 3.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5ZM12.75 12a2.25 2.25 0 1 1 4.5 0 2.25 2.25 0 0 1-4.5 0ZM9 15.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}))}const gt=n.forwardRef(ht);function ft({title:m,titleId:x,...f},y){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:y,"aria-labelledby":x},f),m?n.createElement("title",{id:x},m):null,n.createElement("path",{fillRule:"evenodd",d:"M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z",clipRule:"evenodd"}))}const $e=n.forwardRef(ft);function xt({title:m,titleId:x,...f},y){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:y,"aria-labelledby":x},f),m?n.createElement("title",{id:x},m):null,n.createElement("path",{fillRule:"evenodd",d:"M11.47 7.72a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 1 1-1.06 1.06L12 9.31l-6.97 6.97a.75.75 0 0 1-1.06-1.06l7.5-7.5Z",clipRule:"evenodd"}))}const Ge=n.forwardRef(xt);function jt({title:m,titleId:x,...f},y){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:y,"aria-labelledby":x},f),m?n.createElement("title",{id:x},m):null,n.createElement("path",{fillRule:"evenodd",d:"M11.078 2.25c-.917 0-1.699.663-1.85 1.567L9.05 4.889c-.02.12-.115.26-.297.348a7.493 7.493 0 0 0-.986.57c-.166.115-.334.126-.45.083L6.3 5.508a1.875 1.875 0 0 0-2.282.819l-.922 1.597a1.875 1.875 0 0 0 .432 2.385l.84.692c.095.078.17.229.154.43a7.598 7.598 0 0 0 0 1.139c.015.2-.059.352-.153.43l-.841.692a1.875 1.875 0 0 0-.432 2.385l.922 1.597a1.875 1.875 0 0 0 2.282.818l1.019-.382c.115-.043.283-.031.45.082.312.214.641.405.985.57.182.088.277.228.297.35l.178 1.071c.151.904.933 1.567 1.85 1.567h1.844c.916 0 1.699-.663 1.85-1.567l.178-1.072c.02-.12.114-.26.297-.349.344-.165.673-.356.985-.57.167-.114.335-.125.45-.082l1.02.382a1.875 1.875 0 0 0 2.28-.819l.923-1.597a1.875 1.875 0 0 0-.432-2.385l-.84-.692c-.095-.078-.17-.229-.154-.43a7.614 7.614 0 0 0 0-1.139c-.016-.2.059-.352.153-.43l.84-.692c.708-.582.891-1.59.433-2.385l-.922-1.597a1.875 1.875 0 0 0-2.282-.818l-1.02.382c-.114.043-.282.031-.449-.083a7.49 7.49 0 0 0-.985-.57c-.183-.087-.277-.227-.297-.348l-.179-1.072a1.875 1.875 0 0 0-1.85-1.567h-1.843ZM12 15.75a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Z",clipRule:"evenodd"}))}const vt=n.forwardRef(jt);function zt(){const[m,x]=n.useState([]),[f,y]=n.useState(!0),[O,oe]=n.useState(""),[v,ie]=n.useState(""),[C,re]=n.useState(""),[z,se]=n.useState(""),[D,le]=n.useState(""),[L,ce]=n.useState(""),[F,de]=n.useState(""),[h,M]=n.useState([]),[g,U]=n.useState([]),[P,me]=n.useState(!1),[u,Ie]=n.useState({tatuatore:!0,stanza:!0,cliente:!0,dataOra:!0,durata:!0,stato:!0,note:!0,azioni:!0}),[w,ue]=n.useState(!0);n.useEffect(()=>{w||me(!1)},[w]),n.useEffect(()=>{S(),W(),Z()},[]);const S=async()=>{try{y(!0),oe("");const e=E("adminToken"),a=new URLSearchParams;C&&a.append("tatuatore_id",C),z&&a.append("stanza_id",z),D&&a.append("stato",D),L&&a.append("data_inizio",L),F&&a.append("data_fine",F);const i=await fetch(`/api/admin/appuntamenti?${a}`,{headers:{Authorization:`Bearer ${e}`}});if(!i.ok)throw new Error("Errore nel recupero appuntamenti");const o=await i.json();x(o.appuntamenti||[])}catch(e){console.error("Errore nel caricamento appuntamenti:",e),oe("Errore nel caricamento degli appuntamenti")}finally{y(!1)}},W=async()=>{var e;try{console.log("[DEBUG] Caricamento tatuatori...");const a=E("adminToken"),i="/api/admin/tatuatori";console.log("[DEBUG] API URL tatuatori:",i),console.log("[DEBUG] Token presente:",!!a),console.log("[DEBUG] Headers:",{Authorization:`Bearer ${a?"***PRESENT***":"MISSING"}`});const o=await fetch(i,{headers:{Authorization:`Bearer ${a}`}});if(console.log("[DEBUG] Response status tatuatori:",o.status),console.log("[DEBUG] Response ok:",o.ok),o.ok){const r=await o.json();console.log("[DEBUG] Dati tatuatori ricevuti:",r),console.log("[DEBUG] Numero tatuatori:",((e=r.tatuatori)==null?void 0:e.length)||0),console.log("[DEBUG] Lista tatuatori:",r.tatuatori||[]),M(r.tatuatori||[]),console.log("[DEBUG] Tatuatori impostati nello stato")}else{console.log("[DEBUG] Errore response tatuatori:",o.statusText),console.log("[DEBUG] Response headers tatuatori:",Object.fromEntries(o.headers.entries()));const r=await o.text();console.log("[DEBUG] Errore dettagliato tatuatori:",r),o.status===0?console.error("[DEBUG] ERRORE CORS: La richiesta è stata bloccata dal browser"):o.status===401?console.error("[DEBUG] ERRORE AUTENTICAZIONE: Token non valido o mancante"):o.status===403?console.error("[DEBUG] ERRORE PERMESSI: Accesso negato all'endpoint"):o.status>=500&&console.error("[DEBUG] ERRORE SERVER: Problema interno del server")}}catch(a){console.error("[DEBUG] Errore nel caricamento tatuatori:",a),console.error("[DEBUG] Errore stack:",a.stack),a.name==="TypeError"&&a.message.includes("fetch")&&(console.error("[DEBUG] ERRORE DI RETE: Impossibile raggiungere il server"),console.error("[DEBUG] Verifica che il backend sia in esecuzione"))}},Z=async()=>{var e;try{console.log("[DEBUG] Caricamento stanze...");const a=E("adminToken"),i="/api/admin/stanze";console.log("[DEBUG] API URL stanze:",i),console.log("[DEBUG] Token presente:",!!a),console.log("[DEBUG] Headers:",{Authorization:`Bearer ${a?"***PRESENT***":"MISSING"}`});const o=await fetch(i,{headers:{Authorization:`Bearer ${a}`}});if(console.log("[DEBUG] Response status stanze:",o.status),console.log("[DEBUG] Response ok:",o.ok),o.ok){const r=await o.json();console.log("[DEBUG] Dati stanze ricevuti:",r),console.log("[DEBUG] Numero stanze:",((e=r.stanze)==null?void 0:e.length)||0),console.log("[DEBUG] Lista stanze:",r.stanze||[]),U(r.stanze||[]),console.log("[DEBUG] Stanze impostate nello stato")}else{console.log("[DEBUG] Errore response stanze:",o.statusText),console.log("[DEBUG] Response headers stanze:",Object.fromEntries(o.headers.entries()));const r=await o.text();console.log("[DEBUG] Errore dettagliato stanze:",r),o.status===0?console.error("[DEBUG] ERRORE CORS: La richiesta è stata bloccata dal browser"):o.status===401?console.error("[DEBUG] ERRORE AUTENTICAZIONE: Token non valido o mancante"):o.status===403?console.error("[DEBUG] ERRORE PERMESSI: Accesso negato all'endpoint"):o.status>=500&&console.error("[DEBUG] ERRORE SERVER: Problema interno del server")}}catch(a){console.error("[DEBUG] Errore nel caricamento stanze:",a),console.error("[DEBUG] Errore stack:",a.stack),a.name==="TypeError"&&a.message.includes("fetch")&&(console.error("[DEBUG] ERRORE DI RETE: Impossibile raggiungere il server"),console.error("[DEBUG] Verifica che il backend sia in esecuzione"))}},Oe=()=>{$("tatuatori"),b(null),j(null),W(),Z(),ve(!0)},Le=()=>{ve(!1),$("tatuatori")},Fe=async()=>{const e=be.trim();if(!e){b({type:"danger",message:"Inserisci il nome del tatuatore."});return}try{Ce(!0),b(null);const a=E("adminToken"),i=await fetch("/api/admin/tatuatori",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({nome:e})});if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.error||"Errore nella creazione del tatuatore")}await W(),Ee(""),b({type:"success",message:"Tatuatore aggiunto con successo."})}catch(a){console.error("Errore creazione tatuatore:",a),b({type:"danger",message:a.message||"Errore nella creazione del tatuatore."})}finally{Ce(!1)}},Me=async(e,a)=>{try{Te(e);const i=E("adminToken"),o=await fetch(`/api/admin/tatuatori/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({attivo:!a})});if(!o.ok){const s=await o.json().catch(()=>({}));throw new Error(s.error||"Errore nell'aggiornamento del tatuatore")}const r=await o.json();M(s=>s.map(c=>c.id===e?{...c,attivo:r.attivo}:c)),b({type:"success",message:`Tatuatore ${a?"disattivato":"attivato"} con successo.`})}catch(i){console.error("Errore aggiornamento tatuatore:",i),b({type:"danger",message:i.message||"Errore nell'aggiornamento del tatuatore."})}finally{Te(null)}},T=e=>{const a=i=>i.toString().padStart(2,"0");return`${e.getUTCFullYear()}${a(e.getUTCMonth()+1)}${a(e.getUTCDate())}T${a(e.getUTCHours())}${a(e.getUTCMinutes())}${a(e.getUTCSeconds())}Z`},V=(e="")=>e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;"),Pe=e=>{if(!(e!=null&&e.orario_inizio))return null;const a=new Date(e.orario_inizio);if(Number.isNaN(a.getTime()))return null;const i=Number(e.durata_minuti||60)||60,o=new Date(a.getTime()+i*6e4),r=["Appuntamento Tatuaggio"];e.tatuatore_nome&&r.push(`con ${e.tatuatore_nome}`),e.cliente_nome&&r.push(`- ${e.cliente_nome}`);const s=[e.tatuatore_nome?`Tatuatore: ${e.tatuatore_nome}`:null,e.stanza_nome?`Stanza: ${e.stanza_nome}`:null,e.cliente_nome?`Cliente: ${e.cliente_nome}`:null,e.cliente_telefono?`Telefono: ${e.cliente_telefono}`:null,e.note?`Note: ${e.note}`:null].filter(Boolean);return{uid:`tinkstudio-${e.id||"evento"}-${Date.now()}`,title:r.join(" "),description:s.join(`
`),location:e.stanza_nome||"",start:a,end:o,clientName:e.cliente_nome||e.cliente_telefono||`appuntamento-${e.id||"tink"}`}},We=e=>{const a=Pe(e);xe(e),je(a)},pe=()=>{xe(null),je(null)},Ze=()=>{if(!l)return;const e=new URL("https://calendar.google.com/calendar/render");e.searchParams.set("action","TEMPLATE"),e.searchParams.set("text",l.title||"Appuntamento Tatuaggio"),e.searchParams.set("dates",`${T(l.start)}/${T(l.end)}`),l.description&&e.searchParams.set("details",l.description),l.location&&e.searchParams.set("location",l.location),window.open(e.toString(),"_blank","noopener,noreferrer")},Ve=()=>{if(!l)return;const e=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//TinkStudio//Appointments//IT","CALSCALE:GREGORIAN","BEGIN:VEVENT",`UID:${l.uid}`,`DTSTAMP:${T(new Date)}`,`DTSTART:${T(l.start)}`,`DTEND:${T(l.end)}`,`SUMMARY:${V(l.title)}`];l.description&&e.push(`DESCRIPTION:${V(l.description)}`),l.location&&e.push(`LOCATION:${V(l.location)}`),e.push("END:VEVENT","END:VCALENDAR");const a=e.join(`\r
`),i=new Blob([a],{type:"text/calendar;charset=utf-8"}),o=URL.createObjectURL(i),r=document.createElement("a"),s=(l.clientName||"appuntamento").replace(/[\\/:*?"<>|]/g,"-");r.href=o,r.download=`${s}.ics`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)},He=async e=>{const a=h.find(r=>r.id===e),i=a!=null&&a.nome?` "${a.nome}"`:"";if(window.confirm(`Sei sicuro di voler eliminare il tatuatore${i}? Questa azione non puo' essere annullata.`))try{_e(e),b(null);const r=E("adminToken"),s=await fetch(`/api/admin/tatuatori/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),c=await s.json().catch(()=>({}));if(!s.ok)throw new Error(c.error||"Errore nell'eliminazione del tatuatore");M(ee=>ee.filter(te=>te.id!==e)),b({type:"success",message:c.message||`Tatuatore${i} eliminato con successo.`})}catch(r){console.error("Errore eliminazione tatuatore:",r),b({type:"danger",message:r.message||"Errore nell'eliminazione del tatuatore."})}finally{_e(null)}},qe=async()=>{const e=ye.trim();if(!e){j({type:"danger",message:"Inserisci il nome della stanza."});return}try{De(!0),j(null);const a=E("adminToken"),i=await fetch("/api/admin/stanze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({nome:e,no_overbooking:Se})});if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.error||"Errore nella creazione della stanza")}await Z(),we(""),Ne(!1),j({type:"success",message:"Stanza aggiunta con successo."})}catch(a){console.error("Errore creazione stanza:",a),j({type:"danger",message:a.message||"Errore nella creazione della stanza."})}finally{De(!1)}},Je=async(e,a)=>{try{Re(e);const i=E("adminToken"),o=await fetch(`/api/admin/stanze/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({attivo:!a})});if(!o.ok){const s=await o.json().catch(()=>({}));throw new Error(s.error||"Errore nell'aggiornamento della stanza")}const r=await o.json();U(s=>s.map(c=>c.id===e?{...c,attivo:r.attivo}:c)),j({type:"success",message:`Stanza ${a?"disattivata":"attivata"} con successo.`})}catch(i){console.error("Errore aggiornamento stanza:",i),j({type:"danger",message:i.message||"Errore nell'aggiornamento della stanza."})}finally{Re(null)}},Qe=async(e,a)=>{try{Be(e);const i=E("adminToken"),o=await fetch(`/api/admin/stanze/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({no_overbooking:!a})});if(!o.ok){const s=await o.json().catch(()=>({}));throw new Error(s.error||"Errore nell'aggiornamento della stanza")}const r=await o.json();U(s=>s.map(c=>c.id===e?{...c,no_overbooking:r.no_overbooking}:c)),j({type:"success",message:`Impostazione overbooking ${a?"disabilitata":"abilitata"} con successo.`})}catch(i){console.error("Errore aggiornamento stanza (overbooking):",i),j({type:"danger",message:i.message||"Errore nell'aggiornamento della stanza."})}finally{Be(null)}},Ye=async e=>{const a=g.find(r=>r.id===e),i=a!=null&&a.nome?` "${a.nome}"`:"";if(window.confirm(`Sei sicuro di voler eliminare la stanza${i}? Questa azione non puo' essere annullata.`))try{Ue(e),j(null);const r=E("adminToken"),s=await fetch(`/api/admin/stanze/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),c=await s.json().catch(()=>({}));if(!s.ok)throw new Error(c.error||"Errore nell'eliminazione della stanza");U(ee=>ee.filter(te=>te.id!==e)),j({type:"success",message:c.message||`Stanza${i} eliminata con successo.`})}catch(r){console.error("Errore eliminazione stanza:",r),j({type:"danger",message:r.message||"Errore nell'eliminazione della stanza."})}finally{Ue(null)}},Ke=async e=>{if(!(!e||!window.confirm("Sei sicuro di voler eliminare questo appuntamento?")))try{const i=E("adminToken");if(!(await fetch(`/api/admin/appuntamenti/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).ok)throw new Error("Errore nell'eliminazione appuntamento");alert("Appuntamento eliminato con successo"),S()}catch(i){console.error("Errore eliminazione:",i),alert("Errore nell'eliminazione dell'appuntamento")}},he=m.filter(e=>{if(!(v!=null&&v.trim()))return!0;const a=v.toLowerCase();return e.cliente_nome&&e.cliente_nome.toLowerCase().includes(a)||e.cliente_telefono&&e.cliente_telefono.toLowerCase().includes(a)||e.tatuatore_nome&&e.tatuatore_nome.toLowerCase().includes(a)||e.stanza_nome&&e.stanza_nome.toLowerCase().includes(a)||e.note&&e.note.toLowerCase().includes(a)}),Xe=e=>{switch(e){case"confermato":return"#10b981";case"completato":return"#059669";case"cancellato":return"#ef4444";case"in_corso":return"#f59e0b";default:return"#6b7280"}},et=e=>{switch(e){case"confermato":return"Confermato";case"completato":return"Completato";case"cancellato":return"Cancellato";case"in_corso":return"In Corso";default:return e||"Sconosciuto"}},tt=[{id:"list",label:"Lista",icon:mt},{id:"calendar",label:"Calendario",icon:ne},{id:"availability",label:"Disponibilità",icon:ct}],A=n.useMemo(()=>{const e=new Date,a=m.length,i=m.filter(r=>r.orario_inizio?new Date(r.orario_inizio)>=e:!1).length,o=m.reduce((r,s)=>{const c=s.stato||"sconosciuto";return r[c]=(r[c]||0)+1,r},{});return{total:a,upcoming:i,confirmed:o.confermato||0,cancelled:o.cancellato||0}},[m]),[R,ge]=n.useState("list");n.useEffect(()=>{typeof window<"u"&&ue(window.innerWidth>=992)},[]);const[at,B]=n.useState(!1),[nt,N]=n.useState(!1),[fe,k]=n.useState(null),[p,xe]=n.useState(null),[l,je]=n.useState(null),[ot,ve]=n.useState(!1),[H,$]=n.useState("tatuatori"),[be,Ee]=n.useState(""),[ye,we]=n.useState(""),[Se,Ne]=n.useState(!1),[q,b]=n.useState(null),[J,j]=n.useState(null),[ke,Ce]=n.useState(!1),[ze,De]=n.useState(!1),[Q,Te]=n.useState(null),[Y,Re]=n.useState(null),[K,Be]=n.useState(null),[X,_e]=n.useState(null),[G,Ue]=n.useState(null);return t.jsxs("div",{className:"appointments-page",children:[t.jsx("header",{className:"appointments-header",children:t.jsxs("div",{className:"appointments-header__text",children:[t.jsxs("h3",{className:"section-title",children:[t.jsx(ne,{className:"section-title-icon","aria-hidden":"true"})," Gestione Appuntamenti"]}),t.jsx("p",{className:"section-description",children:"Gestisci tutti gli appuntamenti con filtri avanzati e viste multiple"})]})}),t.jsxs("section",{className:"appointments-metrics","aria-label":"Statistiche appuntamenti",children:[t.jsxs("div",{className:"appointments-metric-card",children:[t.jsx("span",{className:"appointments-metric-label",children:"Totale"}),t.jsx("span",{className:"appointments-metric-value",children:A.total})]}),t.jsxs("div",{className:"appointments-metric-card",children:[t.jsx("span",{className:"appointments-metric-label",children:"In arrivo"}),t.jsx("span",{className:"appointments-metric-value",children:A.upcoming})]}),t.jsxs("div",{className:"appointments-metric-card",children:[t.jsx("span",{className:"appointments-metric-label",children:"Confermati"}),t.jsx("span",{className:"appointments-metric-value",children:A.confirmed})]}),t.jsxs("div",{className:"appointments-metric-card",children:[t.jsx("span",{className:"appointments-metric-label",children:"Cancellati"}),t.jsx("span",{className:"appointments-metric-value",children:A.cancelled})]})]}),t.jsxs("div",{className:"appointments-toolbar",children:[t.jsx("div",{className:"appointments-view-tabs",role:"tablist",children:tt.map(e=>{const a=e.icon;return t.jsxs("button",{type:"button",className:`appointments-view-tab ${R===e.id?"is-active":""}`,onClick:()=>ge(e.id),role:"tab","aria-selected":R===e.id,children:[t.jsx(a,{className:"icon-inline icon-no-margin","aria-hidden":"true"}),t.jsx("span",{children:e.label})]},e.id)})}),t.jsxs("div",{className:"appointments-toolbar__actions",children:[t.jsxs(d,{variant:"secondary",onClick:S,className:"appointments-toolbar__action hide-desktop",disabled:f,children:[t.jsx(it,{className:"icon-inline icon-no-margin","aria-hidden":"true"}),"Aggiorna"]}),t.jsxs(d,{variant:"secondary",onClick:Oe,className:"appointments-toolbar__action hide-mobile",children:[t.jsx(vt,{className:"icon-inline icon-no-margin","aria-hidden":"true"}),"Impostazioni"]}),t.jsxs(d,{onClick:()=>B(!0),className:"appointments-toolbar__action hide-mobile appointments-action-btn--primary",children:[t.jsx(rt,{className:"icon-inline icon-no-margin","aria-hidden":"true"}),"Nuovo"]})]})]}),t.jsxs("div",{className:"appointments-content",children:[R==="list"&&t.jsxs(t.Fragment,{children:[t.jsxs("section",{className:"appointments-filter-card",children:[t.jsxs("button",{type:"button",className:"appointments-filter-toggle",onClick:()=>ue(e=>!e),"aria-expanded":w,children:[t.jsxs("div",{children:[t.jsx(gt,{className:"icon-inline icon-no-margin","aria-hidden":"true"}),t.jsx("span",{children:"Filtri"})]}),w?t.jsx(Ge,{className:"icon-inline icon-no-margin","aria-hidden":"true"}):t.jsx($e,{className:"icon-inline icon-no-margin","aria-hidden":"true"})]}),w&&t.jsxs("div",{className:"appointments-filters-grid",children:[t.jsxs("div",{className:"filter-field",children:[t.jsx("label",{children:"Ricerca libera"}),t.jsx(_,{value:v,onChange:e=>ie(e.target.value),placeholder:"Cliente, tatuatore, note...",className:"filter-input"})]}),t.jsxs("div",{className:"filter-field",children:[t.jsx("label",{children:"Tatuatore"}),t.jsxs("select",{value:C,onChange:e=>re(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"Tutti i tatuatori"}),h.map(e=>t.jsx("option",{value:e.id,children:e.nome},e.id))]})]}),t.jsxs("div",{className:"filter-field",children:[t.jsx("label",{children:"Stanza"}),t.jsxs("select",{value:z,onChange:e=>se(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"Tutte le stanze"}),g.map(e=>t.jsx("option",{value:e.id,children:e.nome},e.id))]})]}),t.jsxs("div",{className:"filter-field",children:[t.jsx("label",{children:"Stato"}),t.jsxs("select",{value:D,onChange:e=>le(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"Tutti gli stati"}),t.jsx("option",{value:"confermato",children:"Confermato"}),t.jsx("option",{value:"in_corso",children:"In Corso"}),t.jsx("option",{value:"completato",children:"Completato"}),t.jsx("option",{value:"cancellato",children:"Cancellato"})]})]}),t.jsxs("div",{className:"filter-field",children:[t.jsx("label",{children:"Dal"}),t.jsx(_,{type:"date",value:L,onChange:e=>ce(e.target.value),className:"filter-input"})]}),t.jsxs("div",{className:"filter-field",children:[t.jsx("label",{children:"Al"}),t.jsx(_,{type:"date",value:F,onChange:e=>de(e.target.value),className:"filter-input"})]})]}),w&&t.jsxs("div",{className:"appointments-filter-actions",children:[t.jsx(d,{onClick:S,disabled:f,children:f?"Caricamento...":"Applica filtri"}),t.jsx(d,{variant:"secondary",onClick:()=>{ie(""),re(""),se(""),le(""),ce(""),de("")},children:"Cancella filtri"}),t.jsxs("div",{className:"appointments-column-picker",children:[t.jsxs(d,{variant:"secondary",onClick:()=>me(!P),children:["Colonne"," ",P?t.jsx(Ge,{className:"icon-inline icon-no-margin","aria-hidden":"true"}):t.jsx($e,{className:"icon-inline icon-no-margin","aria-hidden":"true"})]}),P&&t.jsx("div",{className:"appointments-column-picker__menu",children:[{key:"tatuatore",label:"Tatuatore"},{key:"stanza",label:"Stanza"},{key:"cliente",label:"Cliente"},{key:"dataOra",label:"Data e Ora"},{key:"durata",label:"Durata"},{key:"stato",label:"Stato"},{key:"note",label:"Note"},{key:"azioni",label:"Azioni"}].map(e=>t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:u[e.key],onChange:a=>{Ie(i=>({...i,[e.key]:a.target.checked}))}}),t.jsx("span",{children:e.label})]},e.key))})]})]})]}),f&&t.jsxs("div",{className:"appointments-state appointments-state--loading",children:[t.jsx("h4",{children:"Caricamento appuntamenti"}),t.jsx("p",{children:"Attendi qualche istante mentre recuperiamo i dati."})]}),!f&&O&&t.jsxs("div",{className:"appointments-state appointments-state--error",children:[t.jsx("h4",{children:"Si è verificato un errore"}),t.jsx("p",{children:O})]}),!f&&!O&&t.jsx("div",{className:"appointments-table-wrapper",children:he.length===0?t.jsxs("div",{className:"appointments-empty-state",children:[t.jsx("h4",{children:v!=null&&v.trim()||C||z||D?"Nessun appuntamento trovato":"Nessun appuntamento presente"}),t.jsx("p",{children:v!=null&&v.trim()||C||z||D?"Prova a modificare i filtri di ricerca":"Gli appuntamenti appariranno qui dopo averne creati di nuovi"})]}):t.jsxs("table",{className:"appointments-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[u.tatuatore&&t.jsx("th",{scope:"col",children:"Tatuatore"}),u.stanza&&t.jsx("th",{scope:"col",children:"Stanza"}),u.cliente&&t.jsx("th",{scope:"col",children:"Cliente"}),u.dataOra&&t.jsx("th",{scope:"col",children:"Data e Ora"}),u.durata&&t.jsx("th",{scope:"col",children:"Durata"}),u.stato&&t.jsx("th",{scope:"col",children:"Stato"}),u.note&&t.jsx("th",{scope:"col",children:"Note"}),u.azioni&&t.jsx("th",{scope:"col",className:"text-center",children:"Azioni"})]})}),t.jsx("tbody",{children:he.map(e=>t.jsxs("tr",{children:[u.tatuatore&&t.jsx("td",{"data-title":"Tatuatore",children:t.jsx("span",{className:"cell-strong",children:e.tatuatore_nome||"Sconosciuto"})}),u.stanza&&t.jsx("td",{"data-title":"Stanza",children:t.jsx("span",{className:"cell-strong",children:e.stanza_nome||"Sconosciuta"})}),u.cliente&&t.jsx("td",{"data-title":"Cliente",children:t.jsxs("div",{className:"cell-stack",children:[e.cliente_nome?t.jsx("span",{className:"cell-strong",children:e.cliente_nome}):t.jsx("span",{className:"cell-muted",children:"Senza cliente"}),e.cliente_telefono&&t.jsxs("span",{className:"cell-subtitle",children:["Telefono: ",e.cliente_telefono]})]})}),u.dataOra&&t.jsx("td",{"data-title":"Data e Ora",children:t.jsxs("div",{className:"cell-stack",children:[t.jsx("span",{className:"cell-strong",children:new Date(e.orario_inizio).toLocaleDateString("it-IT")}),t.jsx("span",{className:"cell-subtitle",children:new Date(e.orario_inizio).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]})}),u.durata&&t.jsxs("td",{"data-title":"Durata",children:[e.durata_minuti," min"]}),u.stato&&t.jsx("td",{"data-title":"Stato",children:t.jsx("span",{className:"status-badge",style:{backgroundColor:Xe(e.stato)},children:et(e.stato)})}),u.note&&t.jsx("td",{"data-title":"Note",children:e.note?t.jsx("span",{className:"cell-note",title:e.note,children:e.note}):t.jsx("span",{className:"cell-muted",children:"Nessuna nota"})}),u.azioni&&t.jsx("td",{"data-title":"Azioni",children:t.jsxs("div",{className:"appointments-row-actions",children:[t.jsx("button",{type:"button",className:"row-action row-action--calendar","aria-label":"Esporta appuntamento su calendario",onClick:()=>We(e),children:t.jsx(ne,{"aria-hidden":"true",className:"row-action__icon"})}),t.jsx("button",{type:"button",className:"row-action row-action--view","aria-label":"Dettagli appuntamento",onClick:()=>{k(e),N(!0)},children:t.jsx(pt,{"aria-hidden":"true",className:"row-action__icon"})}),t.jsx("button",{type:"button",className:"row-action row-action--edit","aria-label":"Modifica appuntamento",onClick:()=>{k(e),N(!0)},children:t.jsx(st,{"aria-hidden":"true",className:"row-action__icon"})}),t.jsx("button",{type:"button",className:"row-action row-action--delete","aria-label":"Elimina appuntamento",onClick:()=>Ke(e.id),children:t.jsx(ut,{"aria-hidden":"true",className:"row-action__icon"})})]})})]},e.id))})]})})]}),R==="calendar"&&t.jsx("div",{className:"appointments-calendar-wrapper",children:t.jsx(lt,{tatuatori:h,stanze:g,onAppointmentClick:e=>{k(e),N(!0)}})}),R==="availability"&&t.jsx("div",{className:"appointments-availability-wrapper",children:t.jsx(dt,{tatuatori:h,stanze:g,onSlotSelect:(e,a)=>{k({orario_inizio:e,durata_minuti:a,tatuatore_id:"",stanza_id:"",cliente_telefono:"",cliente_nome:"",note:"",stato:"confermato"}),B(!0),ge("list")}})})]}),t.jsx(I,{isOpen:at,onClose:()=>B(!1),title:"Crea nuovo appuntamento",maxWidth:"800px",children:(console.log("[DEBUG] Props per AppointmentForm (creazione):"),console.log("[DEBUG] Numero tatuatori passati:",(h==null?void 0:h.length)||0),console.log("[DEBUG] Lista tatuatori:",h||[]),console.log("[DEBUG] Numero stanze passate:",(g==null?void 0:g.length)||0),console.log("[DEBUG] Lista stanze:",g||[]),t.jsx(Ae,{tatuatori:h,stanze:g,onSave:()=>{B(!1),S()},onCancel:()=>B(!1)}))}),t.jsx(I,{isOpen:nt,onClose:()=>N(!1),title:"Modifica appuntamento",maxWidth:"800px",children:(console.log("[DEBUG] Props per AppointmentForm (modifica):"),console.log("[DEBUG] Numero tatuatori passati:",(h==null?void 0:h.length)||0),console.log("[DEBUG] Lista tatuatori:",h||[]),console.log("[DEBUG] Numero stanze passate:",(g==null?void 0:g.length)||0),console.log("[DEBUG] Lista stanze:",g||[]),console.log("[DEBUG] Appointment da modificare:",fe),t.jsx(Ae,{appointment:fe,tatuatori:h,stanze:g,onSave:()=>{N(!1),k(null),S()},onCancel:()=>{N(!1),k(null)}}))}),t.jsx(I,{isOpen:!!p,onClose:pe,title:"Salva promemoria calendario",maxWidth:"520px",children:l?t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.25rem"},children:[t.jsxs("div",{style:{color:"#e5e7eb",fontSize:"0.9rem",lineHeight:1.5},children:[t.jsxs("div",{style:{marginBottom:"0.35rem"},children:[t.jsx("strong",{children:"Data:"})," ",l.start.toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),t.jsxs("div",{style:{marginBottom:"0.35rem"},children:[t.jsx("strong",{children:"Orario:"})," ",l.start.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})," - ",l.end.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})]}),(p==null?void 0:p.tatuatore_nome)&&t.jsxs("div",{style:{marginBottom:"0.35rem"},children:[t.jsx("strong",{children:"Tatuatore:"})," ",p.tatuatore_nome]}),(p==null?void 0:p.stanza_nome)&&t.jsxs("div",{style:{marginBottom:"0.35rem"},children:[t.jsx("strong",{children:"Stanza:"})," ",p.stanza_nome]}),(p==null?void 0:p.cliente_nome)&&t.jsxs("div",{style:{marginBottom:"0.35rem"},children:[t.jsx("strong",{children:"Cliente:"})," ",p.cliente_nome]}),(p==null?void 0:p.cliente_telefono)&&t.jsxs("div",{children:[t.jsx("strong",{children:"Telefono:"})," ",p.cliente_telefono]})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:"#9ca3af",fontSize:"0.85rem",marginBottom:"0.75rem"},children:"Scegli come salvare l'appuntamento: puoi aprirlo direttamente su Google Calendar oppure scaricare un file .ics compatibile con Apple Calendar, Outlook e la maggior parte dei calendari."}),t.jsxs("div",{style:{display:"flex",flexWrap:"nowrap",gap:"0.75rem"},children:[t.jsx(d,{type:"button",onClick:Ze,style:{width:"auto",minWidth:"auto",flex:"0 0 auto",maxWidth:"none"},children:"Aggiungi su Google Calendar"}),t.jsx(d,{type:"button",variant:"secondary",onClick:Ve,style:{width:"auto",minWidth:"auto",flex:"0 0 auto",maxWidth:"none"},children:"Scarica promemoria (.ics)"}),t.jsx(d,{type:"button",variant:"ghost",onClick:pe,style:{width:"auto",minWidth:"auto",flex:"0 0 auto",maxWidth:"none"},children:"Chiudi"})]})]})]}):t.jsx(ae,{type:"error",children:"Dettagli calendario non disponibili per questo appuntamento. Riprova più tardi."})}),t.jsxs(I,{isOpen:ot,onClose:Le,title:"Impostazioni risorse",maxWidth:"720px",children:[t.jsxs("div",{style:{marginBottom:"1.5rem",color:"#d1d5db",lineHeight:1.5,fontSize:"0.95rem"},children:[t.jsx("p",{style:{marginBottom:"0.5rem"},children:"Aggiungi e gestisci tatuatori e stanze per poter assegnare correttamente gli appuntamenti."}),t.jsx("p",{style:{margin:0},children:"Ricorda che per creare un nuovo appuntamento è necessario avere almeno un tatuatore e una stanza attivi."})]}),t.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",flexWrap:"wrap"},children:[t.jsx(d,{variant:H==="tatuatori"?"primary":"ghost",onClick:()=>{$("tatuatori"),b(null)},style:{padding:"0.5rem 1rem",fontSize:"0.9rem"},children:"Tatuatori"}),t.jsx(d,{variant:H==="stanze"?"primary":"ghost",onClick:()=>{$("stanze"),j(null)},style:{padding:"0.5rem 1rem",fontSize:"0.9rem"},children:"Stanze"})]}),H==="tatuatori"?t.jsxs("div",{children:[q&&t.jsx(ae,{type:q.type,style:{marginBottom:"1rem"},children:q.message}),t.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap",marginBottom:"1.5rem"},children:[t.jsx(_,{value:be,onChange:e=>Ee(e.target.value),placeholder:"Nome tatuatore",style:{flex:"1 1 240px",minWidth:"200px"}}),t.jsx(d,{onClick:Fe,disabled:ke,style:{padding:"0.75rem 1.5rem",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:ke?"Salvataggio...":"Aggiungi tatuatore"})]}),t.jsx("div",{children:h.length===0?t.jsx("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px dashed rgba(255, 255, 255, 0.2)",borderRadius:"6px",padding:"1.5rem",textAlign:"center",color:"#9ca3af"},children:"Nessun tatuatore presente. Aggiungine uno per iniziare a pianificare gli appuntamenti."}):t.jsx("div",{style:{display:"grid",gap:"1rem"},children:h.map(e=>t.jsx("div",{style:{background:"rgba(0, 0, 0, 0.6)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",padding:"1rem"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("div",{style:{flex:"1 1 auto"},children:[t.jsx("div",{style:{fontSize:"1rem",fontWeight:"600",color:"#f9fafb",marginBottom:"0.25rem"},children:e.nome}),t.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:t.jsx("span",{style:{background:e.attivo?"rgba(16, 185, 129, 0.15)":"rgba(239, 68, 68, 0.15)",color:e.attivo?"#34d399":"#f87171",padding:"0.25rem 0.6rem",borderRadius:"9999px",fontSize:"0.8rem",fontWeight:"600"},children:e.attivo?"Attivo":"Disattivato"})})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsx(d,{variant:"secondary",onClick:()=>Me(e.id,e.attivo),disabled:Q===e.id||X===e.id,style:{padding:"0.5rem 1rem",fontSize:"0.85rem"},children:Q===e.id?"Aggiornamento...":e.attivo?"Disattiva":"Attiva"}),t.jsx(d,{variant:"danger",onClick:()=>He(e.id),disabled:X===e.id||Q===e.id,style:{padding:"0.5rem 1rem",fontSize:"0.85rem"},children:X===e.id?"Eliminazione...":"Elimina"})]})]})},e.id))})})]}):t.jsxs("div",{children:[J&&t.jsx(ae,{type:J.type,style:{marginBottom:"1rem"},children:J.message}),t.jsxs("div",{style:{display:"grid",gap:"0.75rem",marginBottom:"1.5rem",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",alignItems:"center"},children:[t.jsx(_,{value:ye,onChange:e=>we(e.target.value),placeholder:"Nome stanza"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#d1d5db",fontSize:"0.9rem"},children:[t.jsx("input",{type:"checkbox",checked:Se,onChange:e=>Ne(e.target.checked)}),"Evita overbooking"]}),t.jsx(d,{onClick:qe,disabled:ze,style:{padding:"0.75rem 1.5rem",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:ze?"Salvataggio...":"Aggiungi stanza"})]}),t.jsx("div",{children:g.length===0?t.jsx("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px dashed rgba(255, 255, 255, 0.2)",borderRadius:"6px",padding:"1.5rem",textAlign:"center",color:"#9ca3af"},children:"Nessuna stanza disponibile. Aggiungi una stanza per pianificare gli appuntamenti."}):t.jsx("div",{style:{display:"grid",gap:"1rem"},children:g.map(e=>t.jsx("div",{style:{background:"rgba(0, 0, 0, 0.6)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",padding:"1rem"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("div",{style:{flex:"1 1 auto"},children:[t.jsx("div",{style:{fontSize:"1rem",fontWeight:"600",color:"#f9fafb",marginBottom:"0.25rem"},children:e.nome}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsx("span",{style:{background:e.attivo?"rgba(16, 185, 129, 0.15)":"rgba(239, 68, 68, 0.15)",color:e.attivo?"#34d399":"#f87171",padding:"0.25rem 0.6rem",borderRadius:"9999px",fontSize:"0.8rem",fontWeight:"600"},children:e.attivo?"Attiva":"Disattivata"}),t.jsx("span",{style:{background:e.no_overbooking?"rgba(24, 24, 27, 0.85)":"rgba(0, 0, 0, 0.45)",color:e.no_overbooking?"#f3f4f6":"#d1d5db",padding:"0.25rem 0.6rem",borderRadius:"9999px",fontSize:"0.8rem",fontWeight:"600"},children:e.no_overbooking?"No overbooking":"Overbooking consentito"})]})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsx(d,{variant:"secondary",onClick:()=>Je(e.id,e.attivo),disabled:Y===e.id||G===e.id,style:{padding:"0.5rem 1rem",fontSize:"0.85rem"},children:Y===e.id?"Aggiornamento...":e.attivo?"Disattiva":"Attiva"}),t.jsx(d,{variant:"ghost",onClick:()=>Qe(e.id,e.no_overbooking),disabled:K===e.id||G===e.id,style:{padding:"0.5rem 1rem",fontSize:"0.85rem"},children:K===e.id?"Aggiornamento...":e.no_overbooking?"Permetti overbooking":"Blocca overbooking"}),t.jsx(d,{variant:"danger",onClick:()=>Ye(e.id),disabled:G===e.id||Y===e.id||K===e.id,style:{padding:"0.5rem 1rem",fontSize:"0.85rem"},children:G===e.id?"Eliminazione...":"Elimina"})]})]})},e.id))})})]})]})]})}export{zt as default};
