import{r as a,j as e,b as T,I as W,B as j,d as D,M as F,g as B}from"./index-CFS5meP2.js";import{F as I}from"./EyeIcon-DnyV7Suk.js";function $({title:s,titleId:l,...d},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":l},d),s?a.createElement("title",{id:l},s):null,a.createElement("path",{fillRule:"evenodd",d:"M9 1.5H5.625c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5Zm6.61 10.936a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 14.47a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"}),a.createElement("path",{d:"M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z"}))}const P=a.forwardRef($);function V({customers:s,onShowCustomerModal:l,onEditCustomer:d,generateConsentPDF:m,deleteConsent:w}){const[i,z]=a.useState(""),[f,S]=a.useState(!1),[o,A]=a.useState({name:!0,contacts:!0,total:!0,active:!0,used:!0,expired:!0,amount:!0,lastPurchase:!0,consents:!0}),[_,c]=a.useState(!1),[b,v]=a.useState(!1),[u,p]=a.useState(""),[E,g]=a.useState([]),[h,x]=a.useState(null),N=t=>{l&&l(t)},M=t=>{d&&d(t)},L=async t=>{v(!0),p(""),g([]),x(t);try{const r=B("adminToken"),n=await fetch(`/api/admin/customers/${t.phone}/consensi`,{headers:{Authorization:`Bearer ${r}`}});if(!n.ok)throw new Error("Errore nel recupero dei consensi.");const k=(await n.json()).consents||[];k.length===0?(alert("Nessun consenso trovato per questo cliente."),x(null),c(!1)):(g(k),c(!0))}catch(r){console.error("Errore consensi:",r),p("Errore nel recupero dei consensi."),c(!0)}finally{v(!1)}},R=async t=>{try{if(!window.confirm("Sei sicuro di voler eliminare questo consenso? Questa azione non può essere annullata."))return;await w(t),g(n=>n.filter(C=>C.id!==t)),alert("Consenso eliminato con successo")}catch(r){console.error("Errore eliminazione:",r),alert("Errore nell'eliminazione del consenso")}},y=s.filter(t=>{if(!(i!=null&&i.trim()))return!0;const r=i.toLowerCase();return t.first_name&&t.first_name.toLowerCase().includes(r)||t.last_name&&t.last_name.toLowerCase().includes(r)||t.phone&&t.phone.toLowerCase().includes(r)||t.email&&t.email.toLowerCase().includes(r)}).sort((t,r)=>r.total_amount-t.total_amount);return e.jsxs("div",{children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(T,{className:"section-title-icon","aria-hidden":"true"})," Elenco Clienti"]}),e.jsx("p",{className:"section-description",children:"Visualizza tutti i clienti con le statistiche delle loro gift card"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:"250px"},children:e.jsx(W,{value:i||"",onChange:t=>z(t.target.value),placeholder:"Cerca per nome, telefono o email...",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px",padding:"0.75rem",color:"#f3f4f6",fontSize:"0.9rem",width:"100%"}})}),e.jsxs("div",{"data-customer-dropdown":"column-selector",style:{position:"relative",display:"inline-block"},children:[e.jsxs(j,{variant:"secondary",onClick:()=>S(!f),style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",padding:"0.75rem 2rem 0.75rem 0.75rem",color:"#ffffff",fontSize:"0.9rem",minWidth:"200px",cursor:"pointer",textAlign:"left",position:"relative"},children:["Colonne visibili",e.jsx("span",{style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",fontSize:"0.8rem"},children:f?"^":"v"})]}),f&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"rgba(0, 0, 0, 0.9)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",marginTop:"0.25rem",zIndex:1e3,backdropFilter:"blur(10px)"},children:[{key:"name",label:"Nome Cliente"},{key:"contacts",label:"Contatti"},{key:"total",label:"Totale Card"},{key:"active",label:"Attive"},{key:"used",label:"Usate"},{key:"expired",label:"Scadute"},{key:"amount",label:"Importo Totale"},{key:"lastPurchase",label:"Ultimo Acquisto"},{key:"consents",label:"Azioni"}].map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.9rem",color:"#ffffff",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:r=>{r.target.style.background="rgba(255, 255, 255, 0.1)"},onMouseLeave:r=>{r.target.style.background="transparent"},children:[e.jsx("input",{type:"checkbox",checked:o[t.key],onChange:r=>{A(n=>({...n,[t.key]:r.target.checked}))},style:{marginRight:"0.5rem",accentColor:"#fbbf24"}}),t.label]},t.key))})]})]}),y.length===0?e.jsx("div",{style:{textAlign:"center",padding:"3rem",color:"#9ca3af",background:"rgba(255, 255, 255, 0.05)",borderRadius:"4px",border:"1px solid rgba(255, 255, 255, 0.1)"},children:i!=null&&i.trim()?e.jsxs(e.Fragment,{children:[e.jsx("h4",{style:{color:"#f3f4f6",marginBottom:"0.5rem",fontSize:"1.1rem"},children:"Nessun cliente trovato"}),e.jsx("p",{style:{margin:0,fontSize:"0.9rem"},children:"Prova a modificare i termini di ricerca"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{style:{color:"#f3f4f6",marginBottom:"0.5rem",fontSize:"1.1rem"},children:"Nessun cliente trovato"}),e.jsx("p",{style:{margin:0,fontSize:"0.9rem"},children:"I clienti appariranno qui dopo aver finalizzato le prime gift card"})]})}):e.jsx("div",{className:"admin-table-wrapper",style:{background:"rgba(255, 255, 255, 0.05)",borderRadius:"4px",border:"1px solid rgba(255, 255, 255, 0.1)",overflowX:"auto",overflowY:"hidden"},children:e.jsxs("table",{className:"admin-table",style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[o.name&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Cliente"}),o.contacts&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Contatti"}),o.total&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"center",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Totale"}),o.active&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"center",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Attive"}),o.used&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"center",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Usate"}),o.expired&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"center",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Scadute"}),o.amount&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"center",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Importo Totale"}),o.lastPurchase&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Ultimo Acquisto"}),o.consents&&e.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"center",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Azioni"})]})}),e.jsx("tbody",{children:y.map((t,r)=>e.jsxs("tr",{style:{borderBottom:r<y.length-1?"1px solid rgba(255, 255, 255, 0.05)":"none"},children:[o.name&&e.jsx("td",{"data-label":"Cliente",style:{padding:"1rem",color:"#f3f4f6"},children:e.jsx("div",{children:e.jsxs("div",{style:{fontWeight:"500"},children:[t.first_name," ",t.last_name]})})}),o.contacts&&e.jsx("td",{"data-label":"Contatti",style:{padding:"1rem",color:"#9ca3af",fontSize:"0.9rem"},children:e.jsxs("div",{children:[t.email&&e.jsx("div",{style:{marginBottom:"0.25rem"},children:t.email}),t.phone&&e.jsx("div",{children:e.jsx("a",{href:`https://wa.me/39${t.phone}`,target:"_blank",rel:"noopener noreferrer",style:{color:"#25d366",textDecoration:"none",fontWeight:"500"},onMouseEnter:n=>{n.target.style.textDecoration="underline"},onMouseLeave:n=>{n.target.style.textDecoration="none"},children:t.phone})}),!t.email&&!t.phone&&e.jsx("span",{style:{color:"#6b7280"},children:"N/A"})]})}),o.total&&e.jsx("td",{"data-label":"Totale",style:{padding:"1rem",textAlign:"center",color:"#f3f4f6",fontWeight:"500"},children:t.total_cards}),o.active&&e.jsx("td",{"data-label":"Attive",style:{padding:"1rem",textAlign:"center",color:"#10b981"},children:t.active_cards}),o.used&&e.jsx("td",{"data-label":"Usate",style:{padding:"1rem",textAlign:"center",color:"#6b7280"},children:t.used_cards}),o.expired&&e.jsx("td",{"data-label":"Scadute",style:{padding:"1rem",textAlign:"center",color:"#ef4444"},children:t.expired_cards}),o.amount&&e.jsxs("td",{"data-label":"Importo Totale",style:{padding:"1rem",textAlign:"center",color:"#fbbf24",fontWeight:"600"},children:["€",t.total_amount.toFixed(2)]}),o.lastPurchase&&e.jsx("td",{"data-label":"Ultimo Acquisto",style:{padding:"1rem",color:"#9ca3af",fontSize:"0.9rem"},children:t.last_purchase?new Date(t.last_purchase).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"}),o.consents&&e.jsx("td",{className:"admin-table-actions","data-label":"Azioni",style:{padding:"1rem",textAlign:"center",color:"#9ca3af",fontSize:"0.9rem"},children:t.phone?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",justifyContent:"center",flexWrap:"nowrap"},children:[e.jsx("button",{className:"icon-only-button",onClick:()=>N(t),title:"Dettagli cliente","aria-label":"Dettagli cliente",style:{background:"rgba(34, 197, 94, 0.2)",border:"1px solid rgba(34, 197, 94, 0.5)",borderRadius:"4px",color:"#4ade80",cursor:"pointer",width:"2.5rem",height:"2.5rem",transition:"background 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(34, 197, 94, 0.3)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(34, 197, 94, 0.2)"},children:e.jsx(I,{"aria-hidden":"true",className:"icon-only-button__icon"})}),e.jsx("button",{className:"icon-only-button",onClick:()=>M(t),title:"Modifica cliente","aria-label":"Modifica cliente",style:{background:"rgba(24, 24, 27, 0.85)",border:"1px solid rgba(75, 85, 99, 0.5)",borderRadius:"4px",color:"#f3f4f6",cursor:"pointer",width:"2.5rem",height:"2.5rem",transition:"background 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(17, 17, 17, 0.9)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(24, 24, 27, 0.85)"},children:e.jsx(D,{"aria-hidden":"true",className:"icon-only-button__icon"})}),e.jsx("button",{className:"icon-only-button",onClick:()=>L(t),title:"Visualizza consensi","aria-label":"Visualizza consensi",style:{background:"rgba(168, 85, 247, 0.2)",border:"1px solid rgba(168, 85, 247, 0.5)",borderRadius:"4px",color:"#a855f7",cursor:"pointer",width:"2.5rem",height:"2.5rem",transition:"background 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(168, 85, 247, 0.3)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(168, 85, 247, 0.2)"},children:e.jsx(P,{"aria-hidden":"true",className:"icon-only-button__icon"})})]}):e.jsx("span",{style:{color:"#6b7280"},children:"N/A"})})]},r))})]})}),e.jsxs(F,{isOpen:_,onClose:()=>{c(!1),g([]),x(null),p("")},title:`Consensi${h?` per ${h.first_name} ${h.last_name}`:""}`,children:[b&&e.jsx("div",{style:{color:"#9ca3af"},children:"Caricamento consensi..."}),!b&&u&&e.jsx("div",{style:{color:"#f87171"},children:u}),!b&&!u&&e.jsx("div",{className:"flex-col gap-lg",children:E.map(t=>e.jsxs("div",{className:"consenso-item",style:{background:"rgba(0, 0, 0, 0.5)",border:"1px solid #4b5563",borderRadius:"4px",padding:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"#f9fafb",fontWeight:"600",marginBottom:"0.25rem"},children:String(t.type||"").toUpperCase()}),e.jsxs("div",{style:{color:"#9ca3af",fontSize:"0.9rem"},children:[new Date(t.submittedAt).toLocaleDateString("it-IT")," alle ",new Date(t.submittedAt).toLocaleTimeString("it-IT")]})]}),e.jsxs("div",{className:"flex gap-sm",children:[e.jsx(j,{variant:"secondary",onClick:()=>m(t.id),"aria-label":"Genera PDF del consenso",style:{background:"rgba(34, 197, 94, 0.2)",border:"1px solid rgba(34, 197, 94, 0.5)",borderRadius:"4px",color:"#22c55e",padding:"0.5rem 1rem",fontSize:"0.8rem",cursor:"pointer"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(34, 197, 94, 0.3)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(34, 197, 94, 0.2)"},children:"Apri PDF"}),e.jsx(j,{variant:"danger",onClick:()=>R(t.id),"aria-label":"Elimina consenso",style:{padding:"0.5rem 1rem",fontSize:"0.8rem"},children:"Elimina"})]})]},t.id))})]})]})}export{V as default};
