import{r as m,j as e,B as f}from"./index-CFS5meP2.js";/* empty css                          */const P={fullName:"",birthCity:"",birthProvince:"",birthDate:"",residenceCity:"",residenceStreet:"",residenceNumber:"",residenceProvince:"",phoneNumber:"",documentType:"",documentIssuer:"",documentNumber:"",isMinorClient:!1,minorName:"",minorBirthCity:"",minorBirthProvince:"",minorBirthDate:"",minorResidenceCity:"",minorResidenceStreet:"",minorResidenceNumber:"",minorResidenceProvince:"",requestedWork:"",artistName:"",appointmentDate:"",acknowledgeInformed:!1,confirmHealth:!1,releaseLiability:!1,consentPublication:!1,acceptPrivacy:!1};function k({onClose:t,onSave:h,existingSignature:p}){const d=m.useRef(null),r=m.useRef(null),u=m.useRef(!1);m.useEffect(()=>{const a=d.current;if(!a)return;const i=a.getContext("2d");if(i.lineCap="round",i.lineJoin="round",i.lineWidth=2,i.strokeStyle="#000000",i.fillStyle="#ffffff",i.fillRect(0,0,a.width,a.height),p){const o=new Image;o.onload=()=>{i.drawImage(o,0,0,a.width,a.height)},o.src=p}r.current=i},[p]);const g=a=>{const i=d.current;if(!i)return{x:0,y:0};const o=i.getBoundingClientRect();if(a.touches&&a.touches[0]){const s=a.touches[0];return{x:s.clientX-o.left,y:s.clientY-o.top}}return{x:a.clientX-o.left,y:a.clientY-o.top}},x=a=>{a.preventDefault();const i=r.current;if(!i)return;const{x:o,y:s}=g(a);i.beginPath(),i.moveTo(o,s),u.current=!0},n=a=>{if(!u.current)return;a.preventDefault();const i=r.current;if(!i)return;const{x:o,y:s}=g(a);i.lineTo(o,s),i.stroke()},j=a=>{if(!u.current)return;a.preventDefault();const i=r.current;i&&(i.closePath(),u.current=!1)},v=()=>{const a=d.current,i=r.current;!a||!i||(i.fillStyle="#ffffff",i.fillRect(0,0,a.width,a.height))},N=()=>{const a=d.current;if(!a){h(null);return}const i=a.toDataURL("image/png");h(i)};return e.jsx("div",{className:"tattoo-consent-signature-backdrop",children:e.jsxs("div",{className:"tattoo-consent-signature-modal",children:[e.jsx("h2",{className:"tattoo-consent-signature-title",children:"Firma digitale"}),e.jsx("p",{className:"tattoo-consent-signature-instructions",children:`Disegna la tua firma nell'area sottostante utilizzando mouse, touch o penna. Quando sei soddisfatto premi "Salva firma".`}),e.jsx("div",{className:"tattoo-consent-signature-canvas",children:e.jsx("canvas",{ref:d,width:640,height:220,className:"tattoo-consent-signature-canvas__inner",onMouseDown:x,onMouseMove:n,onMouseUp:j,onMouseLeave:j,onTouchStart:x,onTouchMove:n,onTouchEnd:j})}),e.jsxs("div",{className:"tattoo-consent-signature-actions",children:[e.jsx(f,{type:"button",variant:"ghost",onClick:v,className:"tattoo-consent-btn",children:"Cancella"}),e.jsx(f,{type:"button",onClick:N,className:"tattoo-consent-btn tattoo-consent-btn--accent",children:"Salva firma"}),e.jsx(f,{type:"button",variant:"ghost",onClick:t,className:"tattoo-consent-btn tattoo-consent-btn--ghost tattoo-consent-btn--align-end",children:"Annulla"})]})]})})}function z(){const[t,h]=m.useState({...P}),[p,d]=m.useState(!1),[r,u]=m.useState(null),[g,x]=m.useState(!1),n=o=>{const{name:s,value:c,type:l,checked:b}=o.target;h(C=>({...C,[s]:l==="checkbox"?b:c}))},j=o=>{const{checked:s}=o.target;h(c=>({...c,isMinorClient:s}))},v=o=>{u(o),d(!1)},N=m.useMemo(()=>!(t.fullName&&t.birthCity&&t.birthProvince&&t.birthDate&&t.residenceCity&&t.residenceStreet&&t.residenceNumber&&t.residenceProvince&&t.phoneNumber&&t.documentType&&t.documentIssuer&&t.documentNumber&&t.requestedWork&&t.artistName&&t.appointmentDate&&t.acknowledgeInformed&&t.confirmHealth&&t.releaseLiability&&t.consentPublication&&t.acceptPrivacy&&r)?!1:t.isMinorClient?!!(t.minorName&&t.minorBirthCity&&t.minorBirthProvince&&t.minorBirthDate&&t.minorResidenceCity&&t.minorResidenceStreet&&t.minorResidenceNumber&&t.minorResidenceProvince):!0,[t,r]),a=()=>{const o=(t.fullName||"").trim().split(/\s+/).filter(Boolean),[s="",...c]=o,l=c.length>0?c.join(" "):s,b=(t.phoneNumber||"").replace(/\D/g,"").trim(),C=[t.residenceStreet,t.residenceNumber].map(D=>(D||"").trim()).filter(Boolean).join(" "),y={type:"tatuaggio",formType:"tatuaggio",firstName:s,lastName:l,fullName:t.fullName,phone:b,phoneNumber:t.phoneNumber,birthDate:t.birthDate,birthCity:t.birthCity,birthProvince:t.birthProvince,birthPlace:t.birthProvince?`${t.birthCity} (${t.birthProvince})`:t.birthCity,address:C,residenceStreet:t.residenceStreet,residenceNumber:t.residenceNumber,residenceCity:t.residenceCity,residenceProvince:t.residenceProvince,documentType:t.documentType,documentIssuer:t.documentIssuer,documentNumber:t.documentNumber,requestedWork:t.requestedWork,artistName:t.artistName,appointmentDate:t.appointmentDate,acknowledgeInformed:t.acknowledgeInformed,confirmHealth:t.confirmHealth,releaseLiability:t.releaseLiability,consentPublication:t.consentPublication,acceptPrivacy:t.acceptPrivacy,isMinorClient:t.isMinorClient,signature:r,submittedAt:new Date().toISOString()};return t.isMinorClient&&(y.minor={name:t.minorName,birthCity:t.minorBirthCity,birthProvince:t.minorBirthProvince,birthDate:t.minorBirthDate,residenceCity:t.minorResidenceCity,residenceStreet:t.minorResidenceStreet,residenceNumber:t.minorResidenceNumber,residenceProvince:t.minorResidenceProvince}),y},i=async o=>{if(o.preventDefault(),!N){window.alert("Per favore completa tutti i campi obbligatori, firma inclusa.");return}const s=a();if(!s.firstName||!s.lastName){window.alert("Inserisci nome e cognome completi per proseguire.");return}if(!s.phone){window.alert("Inserisci un numero di telefono valido (solo numeri).");return}x(!0);try{const c=await fetch("/api/consenso/tatuaggio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),l=await c.json().catch(()=>({}));if(!c.ok){const b=(l==null?void 0:l.error)||(l==null?void 0:l.message)||"Si è verificato un errore durante il salvataggio del consenso.";throw new Error(b)}console.info("Consenso tatuaggio salvato",{payload:s,response:l}),window.alert("Consenso registrato correttamente. Riceverai conferma al momento della seduta."),h({...P}),u(null)}catch(c){console.error("Errore durante il salvataggio del consenso tatuaggio:",c),window.alert(c.message||"Si è verificato un errore inatteso durante la registrazione del consenso.")}finally{x(!1)}};return e.jsxs("div",{className:"main-container",children:[e.jsxs("div",{className:"glass-card tattoo-consent-card",children:[e.jsx("header",{className:"tattoo-consent-header",children:e.jsx("p",{className:"tattoo-consent-subtitle",children:"Compila ogni sezione con attenzione. Tutte le informazioni sono necessarie per procedere alla prestazione richiesta presso T'ink Tattoo Studio."})}),e.jsxs("form",{onSubmit:i,className:"tattoo-consent-form",children:[e.jsxs("section",{className:"tattoo-consent-section",children:[e.jsxs("div",{className:"tattoo-consent-section__header",children:[e.jsx("span",{className:"tattoo-consent-section__badge",children:"01"}),e.jsx("h2",{className:"tattoo-consent-section__title",children:"Dati del dichiarante"})]}),e.jsxs("div",{className:"tattoo-consent-grid tattoo-consent-grid--two",children:[e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Il/La sottoscritto/a *"}),e.jsx("input",{name:"fullName",value:t.fullName,onChange:n,placeholder:"Nome e cognome",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Nato/a a *"}),e.jsx("input",{name:"birthCity",value:t.birthCity,onChange:n,placeholder:"Citta' di nascita",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Provincia (sigla) *"}),e.jsx("input",{name:"birthProvince",value:t.birthProvince,onChange:n,placeholder:"Es. NA",maxLength:2,required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Data di nascita *"}),e.jsx("input",{type:"date",name:"birthDate",value:t.birthDate,onChange:n,required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Residente a *"}),e.jsx("input",{name:"residenceCity",value:t.residenceCity,onChange:n,placeholder:"Comune di residenza",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Via *"}),e.jsx("input",{name:"residenceStreet",value:t.residenceStreet,onChange:n,placeholder:"Via/Piazza",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Nr. civico *"}),e.jsx("input",{name:"residenceNumber",value:t.residenceNumber,onChange:n,placeholder:"Numero",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Provincia di residenza *"}),e.jsx("input",{name:"residenceProvince",value:t.residenceProvince,onChange:n,placeholder:"Es. NA",maxLength:2,required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Numero di cellulare *"}),e.jsx("input",{name:"phoneNumber",value:t.phoneNumber,onChange:n,placeholder:"+39 ...",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Tipo di documento *"}),e.jsx("input",{name:"documentType",value:t.documentType,onChange:n,placeholder:"Carta di identita' / Passaporto ...",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Rilasciato da *"}),e.jsx("input",{name:"documentIssuer",value:t.documentIssuer,onChange:n,placeholder:"Comune / Questura ...",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Numero documento *"}),e.jsx("input",{name:"documentNumber",value:t.documentNumber,onChange:n,placeholder:"Inserisci numero documento",required:!0})]})]})]}),e.jsxs("section",{className:"tattoo-consent-section",children:[e.jsxs("div",{className:"tattoo-consent-section__header",children:[e.jsx("span",{className:"tattoo-consent-section__badge",children:"02"}),e.jsx("h2",{className:"tattoo-consent-section__title",children:"Cliente minorenne"})]}),e.jsxs("label",{className:"tattoo-consent-checkbox tattoo-consent-checkbox--toggle",children:[e.jsx("input",{type:"checkbox",checked:t.isMinorClient,onChange:j}),e.jsx("span",{children:"Il cliente che riceve il tatuaggio e' minorenne"})]}),t.isMinorClient?e.jsxs("div",{className:"tattoo-consent-grid tattoo-consent-grid--two tattoo-consent-grid--minor",children:[e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Genitore/Tutore di *"}),e.jsx("input",{name:"minorName",value:t.minorName,onChange:n,placeholder:"Nome e cognome del minore",required:t.isMinorClient})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Nato/a a *"}),e.jsx("input",{name:"minorBirthCity",value:t.minorBirthCity,onChange:n,placeholder:"Citta' di nascita del minore",required:t.isMinorClient})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Provincia (sigla) *"}),e.jsx("input",{name:"minorBirthProvince",value:t.minorBirthProvince,onChange:n,placeholder:"Es. NA",maxLength:2,required:t.isMinorClient})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Data di nascita *"}),e.jsx("input",{type:"date",name:"minorBirthDate",value:t.minorBirthDate,onChange:n,required:t.isMinorClient})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Residente a *"}),e.jsx("input",{name:"minorResidenceCity",value:t.minorResidenceCity,onChange:n,placeholder:"Comune di residenza del minore",required:t.isMinorClient})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Via *"}),e.jsx("input",{name:"minorResidenceStreet",value:t.minorResidenceStreet,onChange:n,placeholder:"Via/Piazza",required:t.isMinorClient})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Nr. civico *"}),e.jsx("input",{name:"minorResidenceNumber",value:t.minorResidenceNumber,onChange:n,placeholder:"Numero",required:t.isMinorClient})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Provincia *"}),e.jsx("input",{name:"minorResidenceProvince",value:t.minorResidenceProvince,onChange:n,placeholder:"Es. NA",maxLength:2,required:t.isMinorClient})]})]}):e.jsx("p",{className:"tattoo-consent-note",children:"Dichiaro sotto la mia responsabilita' di essere maggiorenne."})]}),e.jsxs("section",{className:"tattoo-consent-section",children:[e.jsxs("div",{className:"tattoo-consent-section__header",children:[e.jsx("span",{className:"tattoo-consent-section__badge",children:"03"}),e.jsx("h2",{className:"tattoo-consent-section__title",children:"Informativa sul trattamento"})]}),e.jsx("p",{className:"tattoo-consent-text",children:"Di essere stato/a informato/a dell'attivita' di tatuaggio e piercing e che:"}),e.jsxs("ol",{className:"tattoo-consent-list",children:[e.jsx("li",{children:"Il tatuaggio consiste nell'introduzione nella cute di pigmenti di varia natura."}),e.jsx("li",{children:"L'esecuzione del tatuaggio avverra' esclusivamente tramite strumenti sterili e monouso."}),e.jsx("li",{children:"La cura del tatuaggio deve essere eseguita minuziosamente per garantire la corretta guarigione."}),e.jsx("li",{children:"L'artista tatuatore potra' interpretare liberamente il soggetto proposto."}),e.jsx("li",{children:"Per rimuovere il tatuaggio e' necessario ricorrere a interventi chirurgici di piccola o media entita'."}),e.jsx("li",{children:"Con tatuaggi e piercing possono essere trasmesse malattie infettive gravi (es. AIDS, epatiti B e C)."}),e.jsx("li",{children:"Si puo' essere o diventare allergici ai pigmenti o ai metalli."}),e.jsx("li",{children:"E' vietato praticare tatuaggi o piercing su cute con infiammazione in atto."})]}),e.jsxs("label",{className:"tattoo-consent-checkbox",children:[e.jsx("input",{type:"checkbox",name:"acknowledgeInformed",checked:t.acknowledgeInformed,onChange:n}),e.jsx("span",{children:"Confermo di aver compreso l'intera informativa di cui sopra *"})]}),e.jsxs("div",{className:"tattoo-consent-info",children:[e.jsx("p",{children:"Dichiaro inoltre di non presentare, al momento della pratica, patologie o situazioni quali malattie del sangue, cardiopatie, diabete non trattato, malattie della pelle, malattie neurologiche, disturbi della cicatrizzazione, gravidanza o allattamento e di non fare uso di farmaci quali anticoagulanti, antiaggreganti, cortisone, immunodepressori o sostanze che favoriscono infezioni."}),e.jsxs("label",{className:"tattoo-consent-checkbox",children:[e.jsx("input",{type:"checkbox",name:"confirmHealth",checked:t.confirmHealth,onChange:n}),e.jsx("span",{children:"Confermo quanto sopra dichiarato in merito al mio stato di salute *"})]})]})]}),e.jsxs("section",{className:"tattoo-consent-section",children:[e.jsxs("div",{className:"tattoo-consent-section__header",children:[e.jsx("span",{className:"tattoo-consent-section__badge",children:"04"}),e.jsx("h2",{className:"tattoo-consent-section__title",children:"Richiesta e responsabilita'"})]}),e.jsxs("div",{className:"tattoo-consent-grid tattoo-consent-grid--two",children:[e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Con la presente richiedo la realizzazione di *"}),e.jsx("input",{name:"requestedWork",value:t.requestedWork,onChange:n,placeholder:"Descrizione del tatuaggio/piercing richiesto",required:!0})]}),e.jsxs("label",{className:"tattoo-consent-field",children:[e.jsx("span",{children:"Ed esonero il sig./la sig.ra *"}),e.jsx("input",{name:"artistName",value:t.artistName,onChange:n,placeholder:"Nome dell'artista",required:!0})]})]}),e.jsxs("label",{className:"tattoo-consent-checkbox",children:[e.jsx("input",{type:"checkbox",name:"releaseLiability",checked:t.releaseLiability,onChange:n}),e.jsx("span",{children:"Esonero l'artista da responsabilita' o richieste di risarcimento legate alla prestazione richiesta *"})]}),e.jsxs("label",{className:"tattoo-consent-checkbox",children:[e.jsx("input",{type:"checkbox",name:"consentPublication",checked:t.consentPublication,onChange:n}),e.jsx("span",{children:"Autorizzo la pubblicazione e l'esposizione di foto o video del lavoro eseguito *"})]})]}),e.jsxs("section",{className:"tattoo-consent-section",children:[e.jsxs("div",{className:"tattoo-consent-section__header",children:[e.jsx("span",{className:"tattoo-consent-section__badge",children:"05"}),e.jsx("h2",{className:"tattoo-consent-section__title",children:"Informativa privacy (D.lgs. 196/2003)"})]}),e.jsx("div",{className:"tattoo-consent-privacy",children:e.jsx("p",{children:"I dati forniti saranno trattati per finalita' di legge con modalita' manuali e/o fotocopia. Il conferimento dei dati e' obbligatorio e il rifiuto comporta l'impossibilita' di procedere con la prestazione. I dati non saranno comunicati o diffusi. Per la progettazione e lo sviluppo del tattoo e' previsto un acconto non rimborsabile in caso di disdetta, rinuncia o mancata presentazione."})}),e.jsxs("label",{className:"tattoo-consent-checkbox",children:[e.jsx("input",{type:"checkbox",name:"acceptPrivacy",checked:t.acceptPrivacy,onChange:n}),e.jsx("span",{children:"Ho letto e accetto l'informativa privacy ai sensi del D.lgs. 196/2003 *"})]})]}),e.jsxs("section",{className:"tattoo-consent-section",children:[e.jsxs("div",{className:"tattoo-consent-section__header",children:[e.jsx("span",{className:"tattoo-consent-section__badge",children:"06"}),e.jsx("h2",{className:"tattoo-consent-section__title",children:"Firma digitale"})]}),e.jsxs("div",{className:"tattoo-consent-signature",children:[r?e.jsxs("div",{className:"tattoo-consent-signature-preview",children:[e.jsx("p",{children:"Firma salvata. Puoi sostituirla in qualsiasi momento."}),e.jsx("img",{src:r,alt:"Firma digitale"})]}):e.jsx("p",{className:"tattoo-consent-text",children:"Per completare il consenso e' richiesta la tua firma digitale. Verra' aperto un pannello in cui potrai disegnarla manualmente."}),e.jsx(f,{type:"button",variant:"secondary",onClick:()=>d(!0),className:"tattoo-consent-btn",children:"Disegna firma"})]}),e.jsx("div",{className:"tattoo-consent-signature-meta",children:e.jsxs("label",{className:"tattoo-consent-field tattoo-consent-signature-date",children:[e.jsx("span",{children:"Data prevista per la prestazione *"}),e.jsx("input",{type:"date",name:"appointmentDate",value:t.appointmentDate,onChange:n,required:!0})]})})]}),e.jsx("div",{className:"tattoo-consent-submit",children:e.jsx(f,{type:"submit",disabled:!N||g,className:"tattoo-consent-btn tattoo-consent-submit__button",children:g?"Invio in corso...":"Invia consenso"})})]})]}),p&&e.jsx(k,{onClose:()=>d(!1),onSave:v,existingSignature:r})]})}export{z as default};
