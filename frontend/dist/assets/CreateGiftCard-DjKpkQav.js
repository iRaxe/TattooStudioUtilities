import{r,j as e,I as C,B as v,A as I,c as k,s as D,g as F}from"./index-CFS5meP2.js";import{F as T}from"./CheckCircleIcon-XUakFUoL.js";function _({title:n,titleId:s,...l},x){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":s},l),n?r.createElement("title",{id:s},n):null,r.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z",clipRule:"evenodd"}))}const L=r.forwardRef(_);function $({onGiftCardCreated:n,onStatsUpdate:s}){const[l,x]=r.useState(""),[p,S]=r.useState(""),[c,z]=r.useState(""),[o,j]=r.useState(""),[f,w]=r.useState(!1),[N,d]=r.useState(""),[a,y]=r.useState(null),B=async()=>{if(!o||parseFloat(o)<=0){d("Inserisci un importo valido");return}const t=l.trim()&&p.trim()&&c.trim(),u=!l.trim()&&!p.trim()&&!c.trim();if(!t&&!u){d("Compila tutti i campi per creare una gift card completa, oppure lascia vuoti nome, cognome e telefono per generare solo un link");return}if(c.trim()&&!/^\d+$/.test(c.trim())){d("Il telefono deve contenere solo numeri");return}w(!0),d("");try{const m=F("adminToken");if(u){const g=await fetch("/api/admin/gift-cards/drafts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({amount:parseFloat(o)})}),i=await g.json();if(g.ok){console.log("Draft creation successful:",i);const h={amount:parseFloat(o),claimUrl:i.claim_url,draftId:i.draft_id,claimToken:i.claim_token,isDraft:!0};if(console.log("Setting lastCreatedCard:",h),y(h),j(""),n&&n(),s&&s(),i.claim_url){const b=await k(i.claim_url);console.log("Link copied to clipboard:",i.claim_url,b?"success":"failed")}}else console.error("Draft creation failed:",i),d(i.message||"Errore durante la creazione")}else{const g=await fetch("/api/admin/gift-cards/complete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({firstName:l.trim(),lastName:p.trim(),phone:c.trim(),amount:parseFloat(o)})}),i=await g.json();if(g.ok){console.log("Complete gift card creation successful:",i);const h={firstName:l.trim(),lastName:p.trim(),phone:c.trim(),amount:parseFloat(o),redeemUrl:i.redeem_url,giftCardId:i.gift_card_id,code:i.code,isDraft:!1};if(console.log("Setting lastCreatedCard for complete card:",h),y(h),x(""),S(""),z(""),j(""),n&&n(),s&&s(),i.redeem_url){const b=await k(i.redeem_url);console.log("Redeem URL copied to clipboard:",i.redeem_url,b?"success":"failed")}}else console.error("Complete gift card creation failed:",i),d(i.message||"Errore durante la creazione")}}catch(m){console.error("Create gift card error:",m),d("Errore di connessione al server")}finally{w(!1)}};return e.jsxs("div",{style:{marginBottom:"2rem"},children:[!a&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(L,{className:"section-title-icon","aria-hidden":"true"})," Crea Gift Card"]}),e.jsxs("p",{className:"section-description",children:[e.jsx("strong",{children:"Solo importo:"})," Genera un link per chi regala la gift card",e.jsx("br",{}),e.jsx("strong",{children:"Tutti i campi:"})," Crea una gift card completa con landing page personalizzata"]}),e.jsxs("div",{className:"input-section",children:[e.jsx(C,{type:"text",value:l,onChange:t=>x(t.target.value),placeholder:"Inserisci il nome",disabled:f}),e.jsx(C,{type:"text",value:p,onChange:t=>S(t.target.value),placeholder:"Inserisci il cognome",disabled:f}),e.jsx(C,{type:"tel",value:c,onChange:t=>z(t.target.value.replace(/\D/g,"")),placeholder:"Inserisci il numero di telefono",disabled:f}),e.jsx(C,{type:"number",step:"0.01",min:"0",value:o,onChange:t=>j(t.target.value),placeholder:"0.00",disabled:f}),e.jsx(v,{onClick:B,disabled:f||!o,className:"full-width-button",children:f?"Creazione in corso...":"Crea Gift Card"})]}),N&&e.jsx(I,{type:"error",children:N})]}),a&&e.jsxs("div",{className:"created-card-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(T,{className:"section-title-icon","aria-hidden":"true"})," ",a.isDraft?"Link Gift Card Generato!":"Gift Card Creata con Successo!"]}),e.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"4px",padding:"1.5rem",marginBottom:"2rem"},children:[e.jsx("div",{style:{marginBottom:"1rem"},children:a.isDraft?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"600",color:"#86efac",marginBottom:"0.5rem"},children:["Importo: €",a.amount]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#9ca3af",marginBottom:"1rem"},children:["ID Bozza: ",a.draftId]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"600",color:"#86efac",marginBottom:"0.5rem"},children:["Cliente: ",a.firstName," ",a.lastName]}),e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"600",color:"#86efac",marginBottom:"0.5rem"},children:["Telefono: ",a.phone]}),e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"600",color:"#86efac",marginBottom:"0.5rem"},children:["Importo: €",a.amount]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#9ca3af",marginBottom:"1rem"},children:["ID Gift Card: ",a.giftCardId]})]})}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:"0.5rem",color:"#f9fafb"},children:a.isDraft?"Link per chi regala:":"Landing Page Personalizzata:"}),e.jsx("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"0.75rem",borderRadius:"4px",fontFamily:"monospace",fontSize:"0.9rem",wordBreak:"break-all",color:"#fbbf24"},children:a.isDraft?a.claimUrl:a.redeemUrl}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#9ca3af",marginTop:"0.5rem",fontStyle:"italic"},children:a.isDraft?"Suggerimento: condividi questo link con chi regala la gift card. Dovrà compilare i dati del festeggiato":"Suggerimento: condividi questo link con il cliente per una esperienza gift card personalizzata e animata"})]}),e.jsxs("div",{className:"flex gap-md flex-wrap",children:[e.jsx(v,{onClick:async()=>{const t=a.isDraft?a.claimUrl:a.redeemUrl,u=await k(t);alert(u?"Link copiato negli appunti!":`Impossibile copiare automaticamente il link.
Copialo manualmente:

${t}`)},variant:"secondary",children:"Copia link"}),e.jsx(v,{onClick:async()=>{const t=a.isDraft?a.claimUrl:a.redeemUrl,u=a.isDraft?`Compila i dati per la gift card di €${a.amount}!`:`Hai ricevuto una gift card di €${a.amount}!`,m=await D({title:"Gift Card Tink Studio",text:u,url:t});m==="copied"?alert(`Condivisione non disponibile su questo dispositivo.
Link copiato negli appunti!`):m==="failed"&&alert(`Impossibile condividere automaticamente il link.
Copialo manualmente:

${t}`)},variant:"secondary",children:"Condividi"}),e.jsx(v,{onClick:()=>y(null),variant:"secondary",children:"Chiudi"})]})]})]})]})}export{$ as default};
