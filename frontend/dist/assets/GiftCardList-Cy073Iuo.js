import{r as n,j as t,I as S,B as x,c as E,F as N,s as R,a as A,g as p}from"./index-CFS5meP2.js";import{F as T,a as L}from"./TrashIcon-Cv36xBOL.js";import{F as $}from"./CheckCircleIcon-XUakFUoL.js";function M({title:s,titleId:l,...c},d){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":l},c),s?n.createElement("title",{id:l},s):null,n.createElement("path",{fillRule:"evenodd",d:"M19.902 4.098a3.75 3.75 0 0 0-5.304 0l-4.5 4.5a3.75 3.75 0 0 0 1.035 6.037.75.75 0 0 1-.646 1.353 5.25 5.25 0 0 1-1.449-8.45l4.5-4.5a5.25 5.25 0 1 1 7.424 7.424l-1.757 1.757a.75.75 0 1 1-1.06-1.06l1.757-1.757a3.75 3.75 0 0 0 0-5.304Zm-7.389 4.267a.75.75 0 0 1 1-.353 5.25 5.25 0 0 1 1.449 8.45l-4.5 4.5a5.25 5.25 0 1 1-7.424-7.424l1.757-1.757a.75.75 0 1 1 1.06 1.06l-1.757 1.757a3.75 3.75 0 1 0 5.304 5.304l4.5-4.5a3.75 3.75 0 0 0-1.035-6.037.75.75 0 0 1-.354-1Z",clipRule:"evenodd"}))}const D=n.forwardRef(M);function W({onStatsUpdate:s,customers:l,onShowCustomerModal:c,onMarkAsUsed:d}){const[y,k]=n.useState([]),[u,j]=n.useState(""),[g,w]=n.useState(!1),[i,v]=n.useState({amount:!0,status:!0,code:!0,customer:!0,created:!0,expires:!0,actions:!0}),f=async()=>{try{const e=p("adminToken"),o=await fetch("/api/admin/gift-cards",{headers:{Authorization:`Bearer ${e}`}});if(o.ok){const r=await o.json();k(r.giftCards||[])}}catch(e){console.error("Error fetching gift cards:",e)}},C=async e=>{if(window.confirm("Sei sicuro di voler eliminare questa gift card? Questa azione non può essere annullata."))try{const r=p("adminToken"),a=await fetch(`/api/admin/gift-cards/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(a.ok)alert("Gift card eliminata con successo"),f(),s&&s();else{const m=await a.json();alert(m.error||"Errore durante l'eliminazione")}}catch(r){console.error("Delete error:",r),alert("Errore di connessione al server")}},z=async e=>{if(window.confirm("Sei sicuro di voler rinnovare la scadenza di questa gift card?"))try{const r=p("adminToken"),a=await fetch(`/api/admin/gift-cards/${e}/renew`,{method:"PUT",headers:{Authorization:`Bearer ${r}`}});if(a.ok){const m=await a.json();alert("Scadenza gift card rinnovata con successo"),f(),s&&s()}else{const m=await a.json();alert(m.error||"Errore durante il rinnovo")}}catch(r){console.error("Renew error:",r),alert("Errore di connessione al server")}},_=async e=>{d&&(await d(e),f())},h=e=>{c&&c(e)};n.useEffect(()=>{f()},[]);const b=y.filter(e=>{if(!u.trim())return!0;const o=u.toLowerCase();return e.code&&e.code.toLowerCase().includes(o)||e.customer_name&&e.customer_name.toLowerCase().includes(o)}).sort((e,o)=>{const r={active:1,draft:2,used:3};return(r[e.status]||999)-(r[o.status]||999)});return t.jsxs("div",{children:[t.jsxs("h3",{className:"section-title",children:[t.jsx(T,{className:"section-title-icon","aria-hidden":"true"})," Elenco Gift Card"]}),t.jsx("p",{className:"section-description",children:"Visualizza tutte le gift card create e il loro stato attuale"}),t.jsxs("div",{className:"gift-card-search-controls",children:[t.jsx("div",{className:"gift-card-search-input",children:t.jsx(S,{value:u,onChange:e=>j(e.target.value),placeholder:"Cerca per codice o nome cliente...",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",padding:"0.75rem",color:"#ffffff",fontSize:"0.9rem",width:"100%"}})}),t.jsx("div",{style:{position:"relative"},children:t.jsxs("div",{"data-dropdown":"column-selector",style:{position:"relative",display:"inline-block"},children:[t.jsxs(x,{variant:"secondary",onClick:()=>w(!g),style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",padding:"0.75rem 2rem 0.75rem 0.75rem",color:"#ffffff",fontSize:"0.9rem",minWidth:"200px",cursor:"pointer",textAlign:"left",position:"relative"},children:["Colonne visibili",t.jsx("span",{style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",fontSize:"0.8rem"},children:g?"^":"v"})]}),g&&t.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"rgba(0, 0, 0, 0.9)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",marginTop:"0.25rem",zIndex:1e3,backdropFilter:"blur(10px)"},children:[{key:"amount",label:"Importo"},{key:"status",label:"Stato"},{key:"code",label:"Codice"},{key:"customer",label:"Cliente"},{key:"created",label:"Data Creazione"},{key:"expires",label:"Scadenza"},{key:"actions",label:"Azioni"}].map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.9rem",color:"#ffffff",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:o=>{o.target.style.background="rgba(255, 255, 255, 0.1)"},onMouseLeave:o=>{o.target.style.background="transparent"},children:[t.jsx("input",{type:"checkbox",checked:i[e.key],onChange:o=>{v(r=>({...r,[e.key]:o.target.checked}))},style:{marginRight:"0.5rem",accentColor:"#fbbf24"}}),e.label]},e.key))})]})})]}),b.length===0?t.jsx("div",{style:{textAlign:"center",padding:"3rem",color:"#9ca3af",background:"rgba(255, 255, 255, 0.05)",borderRadius:"4px",border:"1px solid rgba(255, 255, 255, 0.1)"},children:u.trim()?t.jsxs(t.Fragment,{children:[t.jsx("h4",{style:{color:"#f3f4f6",marginBottom:"0.5rem",fontSize:"1.1rem"},children:"Nessuna gift card trovata"}),t.jsx("p",{style:{margin:0,fontSize:"0.9rem"},children:"Prova a modificare i termini di ricerca"})]}):t.jsxs(t.Fragment,{children:[t.jsx("h4",{style:{color:"#f3f4f6",marginBottom:"0.5rem",fontSize:"1.1rem"},children:"Nessuna gift card trovata"}),t.jsx("p",{style:{margin:0,fontSize:"0.9rem"},children:"Le gift card appariranno qui dopo la creazione"})]})}):t.jsx("div",{className:"gift-card-list-container admin-table-wrapper",style:{background:"rgba(255, 255, 255, 0.05)",borderRadius:"4px",border:"1px solid rgba(255, 255, 255, 0.1)",overflowX:"auto",overflowY:"hidden"},children:t.jsxs("table",{className:"gift-card-table admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[i.amount&&t.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Importo"}),i.status&&t.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Stato"}),i.code&&t.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Codice"}),i.customer&&t.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Cliente"}),i.created&&t.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Creata"}),i.expires&&t.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Scadenza"}),i.actions&&t.jsx("th",{scope:"col",style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#fbbf24",fontSize:"0.9rem"},children:"Azioni"})]})}),t.jsx("tbody",{children:b.map((e,o)=>t.jsxs("tr",{style:{borderBottom:o<b.length-1?"1px solid rgba(255, 255, 255, 0.05)":"none"},children:[i.amount&&t.jsxs("td",{"data-label":"Importo",style:{padding:"1rem",fontWeight:"600",color:"#fbbf24"},children:["€",e.amount]}),i.status&&t.jsx("td",{"data-label":"Stato",style:{padding:"1rem"},children:t.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"500",background:e.status==="active"?"rgba(34, 197, 94, 0.2)":e.status==="used"?"rgba(239, 68, 68, 0.2)":e.status==="draft"?"rgba(251, 191, 36, 0.2)":"rgba(156, 163, 175, 0.2)",color:e.status==="active"?"#22c55e":e.status==="used"?"#ef4444":e.status==="draft"?"#fbbf24":"#9ca3af"},children:e.status==="draft"?"Bozza":e.status==="active"?"Attiva":e.status==="used"?"Utilizzata":e.status==="expired"?"Scaduta":e.status})}),i.code&&t.jsx("td",{"data-label":"Codice",style:{padding:"1rem",fontFamily:"monospace",fontSize:"0.9rem",color:e.code?"#e5e7eb":"#6b7280"},children:e.code||"N/A"}),i.customer&&t.jsx("td",{"data-label":"Cliente",style:{padding:"1rem",fontSize:"0.9rem",color:"#e5e7eb"},children:e.customer_name&&e.customer_name!=="N/A"?t.jsx(x,{variant:"secondary",type:"button",onClick:()=>{const r=l.find(a=>`${a.first_name} ${a.last_name}`===e.customer_name||a.phone===e.phone);if(r)h(r);else{const a={first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",birth_date:e.birth_date||"",birth_place:"",fiscal_code:"",address:"",city:""};h(a)}},style:{background:"none",border:"none",color:"#f3f4f6",cursor:"pointer",textDecoration:"underline",fontSize:"0.9rem",padding:0},onMouseEnter:r=>{r.target.style.color="#fbbf24"},onMouseLeave:r=>{r.target.style.color="#f3f4f6"},children:e.customer_name}):t.jsx("span",{style:{color:"#6b7280"},children:"N/A"})}),i.created&&t.jsx("td",{"data-label":"Creata",style:{padding:"1rem",fontSize:"0.9rem",color:"#e5e7eb"},children:e.created_at?new Date(e.created_at).toLocaleDateString("it-IT"):"N/A"}),i.expires&&t.jsx("td",{"data-label":"Scadenza",style:{padding:"1rem",fontSize:"0.9rem",color:e.expires_at&&new Date(e.expires_at)<new Date?"#ef4444":"#e5e7eb"},children:e.expires_at?new Date(e.expires_at).toLocaleDateString("it-IT"):"N/A"}),i.actions&&t.jsx("td",{className:"admin-table-actions","data-label":"Azioni",style:{padding:"1rem"},children:t.jsxs("div",{className:"flex gap-sm flex-wrap",children:[e.status==="draft"&&e.claim_token&&t.jsx("button",{className:"icon-only-button",onClick:async()=>{const r=`${window.location.origin}/gift/claim/${e.claim_token}`,a=await E(r);alert(a?`Link copiato negli appunti!

${r}`:`Impossibile copiare automaticamente il link.
Copialo manualmente:

${r}`)},title:"Copia link gift card","aria-label":"Copia link gift card",style:{background:"rgba(251, 191, 36, 0.2)",border:"1px solid rgba(251, 191, 36, 0.5)",color:"#fbbf24",borderRadius:"4px",cursor:"pointer",width:"2.5rem",height:"2.5rem",transition:"background 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(251, 191, 36, 0.3)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(251, 191, 36, 0.2)"},children:t.jsx(D,{"aria-hidden":"true",className:"icon-only-button__icon"})}),e.status==="draft"&&e.claim_token&&t.jsx("button",{className:"icon-only-button",onClick:async()=>{const r=`${window.location.origin}/gift/claim/${e.claim_token}`,a=await R({title:"Gift Card Tink Studio",text:`Completa i dati per la gift card di €${e.amount}!`,url:r});a==="copied"?alert(`Condivisione non disponibile su questo dispositivo.
Link copiato negli appunti!`):a==="failed"&&alert(`Impossibile condividere automaticamente il link.
Copialo manualmente:

${r}`)},title:"Condividi link gift card","aria-label":"Condividi link gift card",style:{background:"rgba(59, 130, 246, 0.2)",border:"1px solid rgba(59, 130, 246, 0.5)",color:"#60a5fa",borderRadius:"4px",cursor:"pointer",width:"2.5rem",height:"2.5rem",transition:"background 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(59, 130, 246, 0.3)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(59, 130, 246, 0.2)"},children:t.jsx(N,{"aria-hidden":"true",className:"icon-only-button__icon"})}),e.status==="active"&&e.code&&t.jsx("button",{className:"icon-only-button",onClick:()=>_(e.code),title:"Marca gift card come usata","aria-label":"Marca gift card come usata",style:{background:"rgba(239, 68, 68, 0.2)",border:"1px solid rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:"4px",cursor:"pointer",width:"2.5rem",height:"2.5rem",transition:"background 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(239, 68, 68, 0.3)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(239, 68, 68, 0.2)"},children:t.jsx($,{"aria-hidden":"true",className:"icon-only-button__icon"})}),e.expires_at&&new Date(e.expires_at)<new Date&&t.jsx("button",{className:"icon-only-button",onClick:()=>z(e.id),title:"Rinnova scadenza gift card","aria-label":"Rinnova scadenza gift card",style:{background:"rgba(34, 197, 94, 0.2)",border:"1px solid rgba(34, 197, 94, 0.5)",color:"#22c55e",borderRadius:"4px",cursor:"pointer",width:"2.5rem",height:"2.5rem",transition:"background 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(34, 197, 94, 0.3)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(34, 197, 94, 0.2)"},children:t.jsx(A,{"aria-hidden":"true",className:"icon-only-button__icon"})}),(e.status==="draft"||e.status==="active"||e.status==="used")&&t.jsx("button",{className:"icon-only-button",onClick:()=>C(e.id),title:"Elimina gift card","aria-label":"Elimina gift card",style:{background:"rgba(239, 68, 68, 0.2)",border:"1px solid rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:"4px",cursor:"pointer",width:"2.5rem",height:"2.5rem",transition:"background 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(239, 68, 68, 0.3)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(239, 68, 68, 0.2)"},children:t.jsx(L,{"aria-hidden":"true",className:"icon-only-button__icon"})})]})})]},e.id))})]})})]})}export{W as default};
